<script>
/*global BazCore */
BazCore.header({
    loadHeaderAt : 'login'
});
</script>
<div class="pace-loading-text ml-1 fixed-top text-orange" hidden>
    <span>Loading... </span>
    <span></span>
</div>
<div id="{{componentId}}" class="login-box">
    <div class="card m-0">
        <div class="card-body login-card-body">
            <div class="login-logo">
                <img src="{{links.images('/baz/logo/fulllogo168x30.png')}}" data-rjs="3" alt="Bazaari Logo">
            </div>
            <div id="{{componentId}}-regular" hidden>
                <p class="login-box-msg text-sm">Login to start {{applicationName|lower}} session</p>
                <form action="{{links.url('auth/login')}}" id="{{componentId}}-form">
                    {{adminltetags.useTag('fields',
                        [
                            'componentId'                           : componentId,
                            'sectionId'                             : 'form',
                            'fieldId'                               : 'user',
                            'fieldLabel'                            : false,
                            'fieldType'                             : 'input',
                            'fieldInputType'                        : 'text',
                            'fieldPlaceholder'                      : 'Username',
                            'fieldBazScan'                          : true,
                            'fieldGroupPostAddonIcon'               : 'user'
                        ]
                    )}}
                    {{adminltetags.useTag('fields',
                        [
                            'componentId'                           : componentId,
                            'sectionId'                             : 'form',
                            'fieldId'                               : 'pass',
                            'fieldLabel'                            : false,
                            'fieldType'                             : 'input',
                            'fieldInputType'                        : 'password',
                            'fieldPlaceholder'                      : 'Password',
                            'fieldBazScan'                          : true,
                            'fieldGroupPostAddonIcon'               : 'lock'
                        ]
                    )}}
                    {{adminltetags.useTag('fields',
                        [
                            'componentId'                           : componentId,
                            'sectionId'                             : 'form',
                            'fieldId'                               : 'remember',
                            'fieldLabel'                            : false,
                            'fieldType'                             : 'checkbox',
                            'fieldCheckboxType'                     : 'success',
                            'fieldCheckboxLabel'                    : 'Remember',
                            'fieldCheckboxAdditionClass'            : 'text-sm text-uppercase',
                            'fieldBazScan'                          : true
                        ]
                    )}}
                    <div class="row mt-2">
                        <div class="col mt-2">
                            <a class="text-info" href="{{links.url('auth/reset')}}">
                                <span>Forgot password?</span>
                            </a>
                        </div>
                        <div class="col">
                            <button id="{{componentId}}-form-submit" type="button" class="btn btn-info float-right">
                                <i class="fa fa-cog fa-spin login-spinner" hidden></i>
                                <span class="sr-only">Loading...</span>
                                <span class="text-uppercase">Login</span>
                            </button>
                        </div>
                    </div>
                </form>
                <div class="login-footer text-sm text-center">
                    <b>
                        <a class="text-teal" href="https://www.bazaari.com.au">Bazaari E Trade Pty. Ltd.</a>
                    </b>
                    <br>
                    Copyright Â© 2014-{{date("Y")}}. All rights reserved.
                </div>
            </div>
        </div>
    </div>
</div>
<script>
/*global Pace BazContentLoader BazCore */
// Pace
$(document).ready(function(){
    'use strict';
    $('#{{componentId}}-regular').attr('hidden', false).addClass('animated fadeIn');
    $('input[name=user]').focus();
    BazCore.footer({
        loadFooterAt : 'login'
    });
});

// Slideshow
(function () {
    'use strict';
    $('body').vegas({
        delay: 300000,
        timer: false,
        shuffle: true,
        slides: [
        { src: '{{links.images("/vegas/2.4.4/images/wp1.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp2.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp3.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp4.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp5.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp6.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp7.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp8.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp9.jpg")}}' },
        { src: '{{links.images("/vegas/2.4.4/images/wp10.jpg")}}' }
        ],
        overlay: '{{links.images("/vegas/2.4.4/overlays/01.png")}}'
    });
})();

// Process login on click of login button or pressing enter
$('#{{componentId}}-form-submit').click(function(e) {
    'use strict';
    $(this).attr('disabled', true);
    e.preventDefault();
    processLogin();
});

$('body').keyup(function(e) {
    'use strict';
    e.preventDefault();
    if (e.keyCode === 13) {
        processLogin();
    }
});

function processLogin() {
    'use strict';
    $('.login-spinner').attr('hidden', false);

    function loginFailed() {
        $('.login-spinner').attr('hidden', true);
        $('.login-box-msg').removeClass('fadeIn').addClass('text-danger animated flash text-bold text-sm');
        $('#{{componentId}}-form :input').prop('disabled', false);
        $('#{{componentId}}-form :input').val('');
        $('#{{componentId}}-form-user').focus();
        $('#{{componentId}}-form-submit').attr('disabled', false);
        setTimeout(function () {
            $('.login-box-msg').removeClass('text-danger animated flash text-bold text-sm');
            $('.login-box-msg').text('Login to start {{applicationName|lower}} session');
            $('.login-box-msg').addClass('animated fadeIn');
        }, 5000);
    }

    function loginSuccess() {
        $('body').vegas('destroy');
        $('.login-spinner').attr('hidden', true);
        $('.login-box-msg').removeClass('text-danger').addClass('text-success text-bold');
        window.location = '/';
    }

    // function loginTwofa() {
    //      $('.login-spinner').attr('hidden', true);
    //     $.get('index.php?route=directory/authentication/twofa', function(data) {
    //         $(".form").html(data);
    //     });
    // }

    $.ajax({
        url             : $('#{{componentId}}-form').attr('action'),
        data            : {
                            'user'      : $('#{{componentId}}-form-user').val().trim(),
                            'pass'      : $('#{{componentId}}-form-pass').val(),
                            'remember'  : $('#{{componentId}}-form-remember')[0].checked
                        },
        method          : 'post',
        dataType        : 'json',
        beforeSend      : function() {
                                $("#{{componentId}}-form :input").prop("disabled", true);
                            },
        error           : function() {
                                $('.login-box-msg').text('Error! Please contact administrator.');
                                loginFailed();
                            },
        success         : function(data) {
                            if (data.responseCode == '0') {
                                $('.login-box-msg').text(data.responseMessage);
                                loginSuccess();
                            } else if (data.responseCode == '1') {
                                $('.login-box-msg').text(data.responseMessage);
                                loginFailed();
                            } else if (data.responseCode == '2') {
                                $('.login-box-msg').text(data.responseMessage); //Account Disabled
                                loginFailed();
                            // }
                            // else if (data.responseCode == 3) {
                            //     loginTwofa();
                            }
                        }
    });
}
</script>