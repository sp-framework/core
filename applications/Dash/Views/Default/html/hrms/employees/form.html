{% if employee['id'] is defined %}
    {% set employeeImage = employee['image'] %}
    {% set employeeId = employee['id'] %}
    {% set employeeAccountId = employee['account_id'] %}
    {% set employeeAccountEmail = employee['account_email'] %}
    {% set employeeStatus = employee['status'] %}
    {% set employeeFirstName = employee['first_name'] %}
    {% set employeeLastName = employee['last_name'] %}
    {% set employeeDesignation = employee['designation'] %}
    {% set employeeManagerId = employee['manager_id'] %}
    {% set employeeType = employee['type_id'] %}
    {% set employeeWorkType = employee['work_type_id'] %}
    {% set employeeHireDate = employee['hire_date'] %}
    {% set employeeTerminateDate = employee['terminate_date'] %}
    {% set employeeHireManagerId = employee['hire_manager_id'] %}
    {% set employeeHireReferrerId = employee['hire_referrer_id'] %}
    {% set employeeEmploymentAttachments = employee['employment_attachments'] %}
    {% set employeeEmploymentNotes = employee['employment_notes'] %}
    {% set employeeContactWork = employee['contact_work'] %}
    {% set employeeContactWorkExt = employee['contact_work_ext'] %}
    {% set employeeContactMobile = employee['contact_mobile'] %}
    {% set employeeContactFax = employee['contact_fax'] %}
    {% set employeeContactOther = employee['contact_other'] %}
    {% set employeeContactLocation = employee['contact_location_id'] %}
    {% set employeeContactStreetAddress = employee['contact_street_address'] %}
    {% set employeeContactStreetAddress2 = employee['contact_street_address_2'] %}
    {% set employeeContactCityId = employee['contact_city_id'] %}
    {% set employeeContactCity = employee['contact_city_name'] %}
    {% set employeeContactPostCode = employee['contact_post_code'] %}
    {% set employeeContactStateId = employee['contact_state_id'] %}
    {% set employeeContactState = employee['contact_state_name'] %}
    {% set employeeContactCountryId = employee['contact_country_id'] %}
    {% set employeeContactCountry = employee['contact_country_name'] %}
    {% set employeeContactNotes = employee['contact_notes'] %}
    {% set employeeSkills = employee['skills'] %}
    {% set employeeSkillsAttachments = employee['skills_attachments'] %}
    {% set employeeAdditionalNotes = employee['additional_notes'] %}
{% else %}
    {% set employeeImage = '' %}
    {% set employeeId = '' %}
    {% set employeeAccountId = '' %}
    {% set employeeAccountEmail = '' %}
    {% set employeeStatus = '' %}
    {% set employeeFirstName = '' %}
    {% set employeeLastName = '' %}
    {% set employeeDesignation = '' %}
    {% set employeeManagerId = '' %}
    {% set employeeType = '' %}
    {% set employeeWorkType = '' %}
    {% set employeeHireDate = '' %}
    {% set employeeTerminateDate = '' %}
    {% set employeeHireManagerId = '' %}
    {% set employeeHireReferrerId = '' %}
    {% set employeeEmploymentAttachments = [] %}
    {% set employeeEmploymentNotes = '' %}
    {% set employeeContactWork = '' %}
    {% set employeeContactWorkExt = '' %}
    {% set employeeContactMobile = '' %}
    {% set employeeContactFax = '' %}
    {% set employeeContactOther = '' %}
    {% set employeeContactLocation = '' %}
    {% set employeeContactStreetAddress = '' %}
    {% set employeeContactStreetAddress2 = '' %}
    {% set employeeContactCityId = '' %}
    {% set employeeContactCity = '' %}
    {% set employeeContactPostCode = '' %}
    {% set employeeContactStateId = '' %}
    {% set employeeContactState = '' %}
    {% set employeeContactCountryId = '' %}
    {% set employeeContactCountry = '' %}
    {% set employeeContactNotes = '' %}
    {% set employeeSkills = '' %}
    {% set employeeSkillsAttachments = [] %}
    {% set employeeAdditionalNotes = '' %}
{% endif %}
<form data-validateon="section" id="{{componentId}}-{{sectionId}}-form">
    <fieldset id="{{componentId}}-{{sectionId}}-fieldset">
        {{adminltetags.useTag('tabs',
            [
                'component'                     : component,
                'componentName'                 : componentName,
                'componentId'                   : componentId,
                'sectionId'                     : 'main',
                'tabsId'                        : 'tabs',
                'tabsStyle'                     : 'card-outline-tabs',
                'tabsData'                      :
                    [
                        'info'   :
                        [
                            'tabTitle'          : 'Info',
                            'tabInclude'        : 'employees/form/info',
                            'tabIncludeParams'  :
                            [
                                'employeeImage'         : employeeImage,
                                'employeeId'            : employeeId,
                                'employeeAccountId'     : employeeAccountId,
                                'employeeAccountEmail'  : employeeAccountEmail,
                                'employeeStatus'        : employeeStatus,
                                'employeeFirstName'     : employeeFirstName,
                                'employeeLastName'      : employeeLastName,
                                'employeeDesignation'   : employeeDesignation,
                                'employeeManagerId'     : employeeManagerId
                            ]
                        ],
                        'employmentdetails'   :
                        [
                            'tabTitle'          : 'Employment Details',
                            'tabInclude'        : 'employees/form/employmentdetails',
                            'tabIncludeParams'  :
                            [
                                'employeeType'                 : employeeType,
                                'employeeHireDate'             : employeeHireDate,
                                'employeeTerminateDate'        : employeeTerminateDate,
                                'employeeHireManagerId'        : employeeHireManagerId,
                                'employeeHireReferrerId'       : employeeHireReferrerId,
                                'employeeEmploymentAttachments': employeeEmploymentAttachments,
                                'employeeEmploymentNotes'      : employeeEmploymentNotes
                            ]
                        ],
                        'contactdetails'   :
                        [
                            'tabTitle'          : 'Contact Details',
                            'tabInclude'        : 'employees/form/contactdetails',
                            'tabIncludeParams'  :
                            [
                                'employeeContactWork'               : employeeContactWork,
                                'employeeContactWorkExt'            : employeeContactWorkExt,
                                'employeeContactMobile'             : employeeContactMobile,
                                'employeeContactFax'                : employeeContactFax,
                                'employeeContactOther'              : employeeContactOther,
                                'employeeWorkType'                  : employeeWorkType,
                                'employeeContactLocation'           : employeeContactLocation,
                                'employeeContactStreetAddress'      : employeeContactStreetAddress,
                                'employeeContactStreetAddress2'     : employeeContactStreetAddress2,
                                'employeeContactCityId'             : employeeContactCityId,
                                'employeeContactCity'               : employeeContactCity,
                                'employeeContactPostCode'           : employeeContactPostCode,
                                'employeeContactStateId'            : employeeContactStateId,
                                'employeeContactState'              : employeeContactState,
                                'employeeContactCountryId'          : employeeContactCountryId,
                                'employeeContactCountry'            : employeeContactCountry,
                                'employeeContactNotes'              : employeeContactNotes
                            ]
                        ],
                        'skills'   :
                        [
                            'tabTitle'          : 'Skills',
                            'tabInclude'        : 'employees/form/skills',
                            'tabIncludeParams'  :
                            [
                                'employeeSkills'                : employeeSkills,
                                'employeeSkillsAttachments'     : employeeSkillsAttachments
                            ]
                        ],
                        'notes'   :
                        [
                            'tabTitle'          : 'Notes',
                            'tabInclude'        : 'employees/form/notes',
                            'tabIncludeParams'  :
                            [
                                'employeeAdditionalNotes'      : employeeAdditionalNotes
                            ]
                        ]
                    ]
            ]
        )}}
    </fieldset>
</form>
<script>
/* globals BazContentFieldsValidator PNotify autoComplete */
var dataCollectionComponent, dataCollectionSection, dataCollectionSectionForm;

if (!window['dataCollection']['{{componentId}}']) {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'] = { };
} else {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'];
}
if (!dataCollectionComponent['{{componentId}}-{{sectionId}}']) {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'] = { };
} else {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'];
}
if (!dataCollectionSection['{{componentId}}-{{sectionId}}-form']) {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'] = { };
} else {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'];
}

dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-id'                              : { },
        '{{componentId}}-{{sectionId}}-account_id'                      : { },
        '{{componentId}}-{{sectionId}}-account_email'                   : {
            afterInit   : function() {
                dataCollectionSectionForm['autoCompleteAccounts'] =
                    new autoComplete({
                        data: {
                            src: async() => {
                                const url = '{{links.url("hrms/employees/searchAccount")}}';

                                var myHeaders = new Headers();
                                myHeaders.append("accept", "application/json");

                                var formdata = new FormData();
                                formdata.append("search", document.querySelector("#{{componentId}}-{{sectionId}}-account_email").value);
                                formdata.append($('#security-token').attr('name'), $('#security-token').val());

                                var requestOptions = {
                                    method: 'POST',
                                    headers: myHeaders,
                                    body: formdata
                                };

                                const response = await fetch(url, requestOptions);

                                const data = await response.json();

                                if (data.tokenKey && data.token) {
                                    $('#security-token').attr('name', data.tokenKey);
                                    $('#security-token').val(data.token);
                                }
                                if (data.accounts) {
                                    return data.accounts;
                                } else {
                                    return [];
                                }
                            },
                            key: ["email"],
                            cache: false
                        },
                        selector: "#{{componentId}}-{{sectionId}}-account_email",
                        threshold : 4,
                        debounce: 500,
                        searchEngine: "strict",
                        resultsList: {
                            render: true,
                            /* if set to false, add an eventListener to the selector for event type
                               "autoComplete" to handle the result */
                            container: source => {
                                source.setAttribute("id", "{{componentId}}-{{sectionId}}-account_email_list");
                                source.setAttribute("class", "autoComplete_results");
                            },
                            destination: document.querySelector("#{{componentId}}-{{sectionId}}-account_email"),
                            position: "afterend",
                            element: "div"
                        },
                        maxResults: 5,                         // Max. number of rendered results | (Optional)
                        highlight: true,                       // Highlight matching results      | (Optional)
                        resultItem: {                          // Rendered result item            | (Optional)
                            content: (data, source) => {
                                source.innerHTML = data.match;
                            },
                            element: "div"
                        },
                        noResults: () => {                     // Action script on noResults      | (Optional)
                            const result = document.createElement("li");
                            result.setAttribute("class", "autoComplete_result text-danger");
                            result.setAttribute("tabindex", "1");
                            result.innerHTML = "No search results. Click field help for more information.";
                            document.querySelector("#{{componentId}}-{{sectionId}}-account_email_list").appendChild(result);
                        },
                        onSelection: feedback => {             // Action script onSelection event | (Optional)
                            $('#{{componentId}}-{{sectionId}}-account_id').val(feedback.selection.value.id);
                            $('#{{componentId}}-{{sectionId}}-account_id').attr('value', feedback.selection.value.id);
                            $('#{{componentId}}-{{sectionId}}-account_email').blur();
                            $('#{{componentId}}-{{sectionId}}-account_email').val(feedback.selection.value.email);
                            $('#{{componentId}}-{{sectionId}}-account_email').attr('value', feedback.selection.value.email);
                        }
                });
                // On delete
                $('#{{componentId}}-{{sectionId}}-account_email').on('input propertychange', function() {
                    $('#{{componentId}}-{{sectionId}}-account_id').val(0);
                    $('#{{componentId}}-{{sectionId}}-account_id').attr('value', 0);
                });

                $('#{{componentId}}-{{sectionId}}-account_email').focusout(function() {
                    $('#{{componentId}}-{{sectionId}}-account_email_list').children('li').remove();
                });
            }
        },
        '{{componentId}}-{{sectionId}}-status'                          : {
            'placeholder' : "SELECT EMPLOYEE STATUS"
        },
        '{{componentId}}-{{sectionId}}-first_name'                      : { },
        '{{componentId}}-{{sectionId}}-last_name'                       : { },
        '{{componentId}}-{{sectionId}}-designation'                     : { },
        '{{componentId}}-{{sectionId}}-manager_id'                      : { },
        '{{componentId}}-{{sectionId}}-type_id'                         : { },
        '{{componentId}}-{{sectionId}}-work_type_id'                    : { },
        '{{componentId}}-{{sectionId}}-hire_date'                       : { },
        '{{componentId}}-{{sectionId}}-terminate_date'                  : { },
        '{{componentId}}-{{sectionId}}-hire_manager_id'                 : { },
        '{{componentId}}-{{sectionId}}-hire_referrer_id'                : { },
        '{{componentId}}-{{sectionId}}-employment_attachments'          : { },
        '{{componentId}}-{{sectionId}}-employment_notes'                : { },
        '{{componentId}}-{{sectionId}}-contact_work'                    : { },
        '{{componentId}}-{{sectionId}}-contact_work_ext'                : { },
        '{{componentId}}-{{sectionId}}-contact_mobile'                  : { },
        '{{componentId}}-{{sectionId}}-contact_fax'                     : { },
        '{{componentId}}-{{sectionId}}-contact_other'                   : { },
        '{{componentId}}-{{sectionId}}-contact_location_id'             : { },
        '{{componentId}}-{{sectionId}}-contact_street_address'          : { },
        '{{componentId}}-{{sectionId}}-contact_street_address_2'        : { },
        '{{componentId}}-{{sectionId}}-contact_city_id'                 : { },
        '{{componentId}}-{{sectionId}}-contact_city_name'               : { },
        '{{componentId}}-{{sectionId}}-contact_post_code'               : { },
        '{{componentId}}-{{sectionId}}-contact_state_id'                : { },
        '{{componentId}}-{{sectionId}}-contact_state_name'              : { },
        '{{componentId}}-{{sectionId}}-contact_country_id'              : { },
        '{{componentId}}-{{sectionId}}-contact_country_name'            : { },
        '{{componentId}}-{{sectionId}}-contact_notes'                   : { },
        '{{componentId}}-{{sectionId}}-skills'                          : { },
        '{{componentId}}-{{sectionId}}-skills_attachments'              : { },
        '{{componentId}}-{{sectionId}}-additional_notes'                : { },
        '{{componentId}}-{{sectionId}}-form'                            : {
            rules: {
                '{{componentId}}-{{sectionId}}-first_name'                   : 'required'
            },
            messages: {
                '{{componentId}}-{{sectionId}}-first_name'                   : 'Please enter brand name',
            }
        }
    });
</script>