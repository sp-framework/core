
{% if cardParams['componentId'] is defined and cardParams['sectionId'] is defined %}
    {% set hasCardId = cardParams['componentId'] ~ '-' ~ cardParams['sectionId'] ~ '-card' %}
{% elseif cardParams['componentId'] is empty and cardParams['sectionId'] is defined %}
    {% set hasCardId = cardParams['sectionId'] ~ '-card' %}
{% elseif cardParams['cardId'] is defined %}
    {% set hasCardId = cardParams['cardId'] ~ '-card' %}
{% else %}
    <span class="text-uppercase text-danger">{{('TEMPLATE ERROR: fieldType missing')}}</span>
{% endif %}
{% if hasCardId is defined %}
    {% if cardParams['cardBg'] is defined %}
        {% set cardBgEnabled = "bg-" ~ cardParams['cardBg'] %}
    {% endif %}
    {# cardCollapsed : if configured, card will start as collapsed #}
    {% if cardParams['cardCollapsed'] is defined and cardParams['cardCollapsed'] %}
        {% set hasCardCollapsed = "collapsed-card" %}
    {% endif %}
    {% if cardParams['cardRefreshSource'] is defined %}
        {% set hasCardRefreshSource = "data-source=" ~ cardParams['cardRefreshSource'] %}
    {% endif %}
    {% if cardParams['cardRefreshParams'] is defined %}
        {% set hasCardRefreshParams = "data-params=" ~ cardParams['cardRefreshParams'] %}
    {% endif %}
    {% if cardParams['cardRefreshDataType'] is defined %}
        {% set hasCardRefreshDataType = "data-datatype=" ~ cardParams['cardRefreshDataType'] %}
    {% endif %}
    {% if cardParams['cardRefreshMethod'] is defined %}
        {% set hasCardRefreshMethod = "data-method=" ~ cardParams['cardRefreshMethod'] %}
    {% endif %}
    {% if cardParams['cardRefreshSourceSelector'] is defined %}
        {% set hasCardRefreshSourceSelector = "data-sourceselector=" ~ cardParams['cardRefreshSourceSelector'] %}
    {% endif %}
    {# card #}
    <div id="{{hasCardId}}" class="card {{cardBgEnabled|default('')}} {{hasCardCollapsed|default('')}} {{cardAdditionalClass|default('')}}">
        {% if cardParams['cardType'] === 'widget' %}
            {% if cardWidgetContent is defined %}
                {{cardWidgetContent|e}}
            {% else %}
                <span class="text-uppercase text-danger">{{('TEMPLATE ERROR: cardWidgetContent missing')}}</span>
            {% endif %}
        {% else %}
            {% if cardParams['cardHeader'] is defined %}
                <div class="card-header rounded-0 bg-{{cardType|default('primary')}} {{cardHeaderAdditionalClass|default('')}}">
                    <h3 class="card-title">
                        {% if cardParams['cardIcon'] is defined %}
                            <span class="widget-icon">
                                <i class="mr-1 fas fa-fw fa-{{cardParams['cardIcon']}} {{cardIconAdditionalClass|default('')}}"></i>
                            </span>
                        {% endif %}
                        <span class="title">{{cardParams['cardTitle']|upper|default('MISSING TITLE')}}</span>
                    </h3>
                    <div class="card-tools">
                        {% if cardParams['cardSpanType'] is defined and cardParams['cardSpanText'] is defined %}
                            <span class="badge bg-{{cardParams['cardSpanType']}}">{{cardParams['cardSpanText']}}</span>
                        {% endif %}
                        {% if cardParams['cardCollapsed'] is defined and cardParams['cardCollapsed'] %}
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-fw fa-plus"></i>
                            </button>
                        {% endif %}
                        {% if cardParams['cardShowTools']|length > 0 %}
                            {# navigators are for jstree, visible in contentType=sections #}
                            {% for cardShowTool in cardParams['cardShowTools'] %}
                                {% if cardShowTool === "navigators" %}
                                    <div class="section-navigators"></div>
                                {% elseif cardShowTool === "jstreeTools" %}
                                    <button type="button" id="collapseTreeCardes" class="btn btn-tool">
                                        <i class="fas fa-fw fa-compress-arrows-alt"></i>
                                    </button>
                                    <button type="button" id="expandTreeCardes" class="btn btn-tool">
                                        <i class="fas fa-fw fa-expand-arrows-alt"></i>
                                    </button>
                                {% elseif cardShowTool === "refresh" %}
                                    <button type="button" class="btn btn-tool" data-card-widget="refresh" {{hasCardRefreshSource}} {{hasCardRefreshParams}} {{hasCardRefreshDataType}} {{hasCardRefreshMethod}} {{hasCardRefreshSourceSelector}}>
                                        <i class="fas fa-fw fa-sync-alt"></i>
                                    </button>
                                {% elseif cardShowTool === "maximize" %}
                                    <button type="button" class="btn btn-tool" data-card-widget="maximize">
                                        <i class="fas fa-fw fa-expand"></i>
                                    </button>
                                {% elseif cardCollapsed is empty or cardCollapsed === false and cardShowTool === "collapse" %}
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-fw fa-minus"></i>
                                    </button>
                                {% elseif cardShowTool === "remove" %}
                                    <button type="button" class="btn btn-tool" data-card-widget="remove">
                                        <i class="fas fa-fw fa-times"></i>
                                    </button>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endif %}
        <div class="card-body {{cardBodyAdditionalClass|default('')}}">
            {% if cardParams['cardBodyIncludeParams'] is defined %}
                {% set hasCardBodyIncludeParams = cardParams['cardBodyIncludeParams'] %}
            {% else %}
                {% set hasCardBodyIncludeParams = [] %}
            {% endif %}
            {% if cardParams['cardBodyInclude'] is defined %}
                {% include cardParams['cardBodyInclude'] with hasCardBodyIncludeParams %}
            {% elseif cardParams['cardBodyWidget'] is defined %}
                {{widget.get(cardParams['cardBodyWidget'])}}
            {% elseif cardParams['cardBodyContent'] is defined %}
                {{cardParams['cardBodyContent']|e}}
            {% endif %}
        </div>
        {% if cardParams['cardFooter'] is defined %}
            <div class="card-footer {{cardFooterAdditionalClass|default('')}}">
                {% if cardParams['cardFooterIncludeParams'] is defined %}
                    {% set hasCardFooterIncludeParams = cardParams['cardFooterIncludeParams'] %}
                {% else %}
                    {% set hasCardFooterIncludeParams = [] %}
                {% endif %}
                {% if cardParams['cardFooterInclude'] is defined %}
                    {% include cardParams['cardFooterInclude'] with hasCardFooterIncludeParams %}
                {% elseif cardParams['cardFooterWidget'] is defined %}
                    {{widget.get(cardParams['cardFooterWidget'])}}
                {% elseif cardParams['cardFooterContent'] is defined %}
                    {{cardParams['cardFooterContent']|e}}
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endif %}
