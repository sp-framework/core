{% set queueTasksCounterInstall = 0 %}
{% set queueTasksCounterUpdate = 0 %}
{% set queueTasksCounterUninstall = 0 %}
{% set queueTasksCounterRemove = 0 %}
{% if queueTasksCounter['install'] is defined %}
    {% set queueTasksCounterInstall = queueTasksCounter['install'] %}
{% endif %}
{% if queueTasksCounter['update'] is defined %}
    {% set queueTasksCounterUpdate = queueTasksCounter['update'] %}
{% endif %}
{% if queueTasksCounter['uninstall'] is defined %}
    {% set queueTasksCounterUninstall = queueTasksCounter['uninstall'] %}
{% endif %}
{% if queueTasksCounter['remove'] is defined %}
    {% set queueTasksCounterRemove = queueTasksCounter['remove'] %}
{% endif %}
<div class="row">
    <div class="col">
        {{adminltetags.useTag('fields',
            [
                'component'                     : component,
                'componentName'                 : componentName,
                'componentId'                   : componentId,
                'sectionId'                     : sectionId,
                'fieldId'                       : 'queue',
                'fieldLabel'                    : false,
                'fieldType'                     : 'counters',
                'fieldCountersPlacementType'    : 'horizontal',
                'fieldCounters'                 :
                    [
                        'install'       :
                            [
                                'id'        : 'install',
                                'title'     : 'Install',
                                'type'      : 'primary',
                                'value'     : queueTasksCounterInstall
                            ],
                        'update'        :
                            [
                                'id'        : 'update',
                                'title'     : 'Update',
                                'type'      : 'info',
                                'value'     : queueTasksCounterUpdate
                            ],
                        'uninstall'     :
                            [
                                'id'        : 'uninstall',
                                'title'     : 'Uninstall',
                                'type'      : 'warning',
                                'value'     : queueTasksCounterUninstall
                            ],
                        'remove'        :
                            [
                                'id'        : 'remove',
                                'title'     : 'Remove',
                                'type'      : 'danger',
                                'value'     : queueTasksCounterRemove
                            ]
                    ]
            ]
        )}}
    </div>
</div>
{% set moduleHtml = '' %}
{% set error = false %}
{% if queueTasks|length > 0 %}
    {% for task, queueTaskModules in queueTasks %}
        {% if task === 'install' or task === 'uninstall' or task === 'update' or task === 'remove' %}
            {% if queueTaskModules|length > 0 %}
                {% for modulesType, modules in queueTaskModules %}
                    {% if modules|length > 0 %}
                        {% for moduleId, module in modules %}
                            {% set color = 'primary' %}
                            {% if task === 'update' %}
                                {% set color = 'info' %}
                            {% elseif task === 'uninstall' %}
                                {% set color = 'warning' %}
                            {% elseif task === 'remove' %}
                                {% set color = 'danger' %}
                            {% endif %}

                            {% if module['error'] is defined %}
                                {% set error = true %}
                                {% set moduleHtml = moduleHtml ~ '<tr class="bg-danger">' %}
                            {% else %}
                                {% set moduleHtml = moduleHtml ~ '</tr><tr>' %}
                            {% endif %}

                            {% set moduleHtml = moduleHtml ~
                            '           <td>' ~  module['name'] ~ '</td>' ~
                            '           <td>' ~  module['module_type'] ~ '</td>' ~
                            '           <td>' ~  module['version'] ~ '</td>' ~
                            '           <td>' ~  module['repo'] ~ '</td>' ~
                            '           <td>' ~  '<span class="badge badge-' ~ color ~ ' mt-1 text-xs text-uppercase">' ~ task ~ '</span></td>' ~
                            '           <td id="{{componentId}}-{{sectionId}}-analyse-queue-modules-precheck-' ~ module['id'] ~ '"></td>' ~
                            '           <td id="{{componentId}}-{{sectionId}}-analyse-queue-modules-completed-' ~ module['id'] ~ '"></td>' %}
                            {% if module['error'] is defined %}
                                {% set moduleHtml = moduleHtml ~
                                '           <td id="{{componentId}}-{{sectionId}}-analyse-queue-modules-logs-' ~ module['id'] ~ '">Error: ' ~ module['error'] ~ '</td>' ~
                                '       </tr>' %}
                            {% else %}
                                {% set moduleHtml = moduleHtml ~
                                    '           <td id="{{componentId}}-{{sectionId}}-analyse-queue-modules-logs-' ~ module['id'] ~ '"></td>' ~
                                    '       ' %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endif %}
    {% endfor %}
{% endif %}
{% if moduleHtml !== '' %}
    <div class="row">
        <div class="col height-control-400">
            <table id="{{componentId}}-{{sectionId}}-queue-table" class="table table-sm table-hover responsive nowrap mb-0" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th class="text-uppercase">Name</th>
                        <th class="text-uppercase">Module Type</th>
                        <th class="text-uppercase">Version</th>
                        <th class="text-uppercase">Repository</th>
                        <th class="text-uppercase">Task</th>
                        <th class="text-uppercase">PreCheck</th>
                        <th class="text-uppercase">Completed</th>
                        <th class="text-uppercase">Logs</th>
                    </tr>
                </thead>
                <tbody>
                    {{moduleHtml}}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div id="{{componentId}}-{{sectionId}}-analyse-queue-modules"></div>
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col">
            <div id="installer-progress" class="mb-3"></div>
        </div>
    </div>
{% endif %}