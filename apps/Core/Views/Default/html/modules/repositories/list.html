{{adminltetags.useTag('fields',
    [
        'component'                         : component,
        'componentName'                     : componentName,
        'componentId'                       : componentId,
        'sectionId'                         : sectionId,
        'parentComponentId'                 : parent,
        'fieldId'                           : 'repositories',
        'fieldLabel'                        : false,
        'fieldType'                         : 'input',
        'fieldAdditionalClass'              : 'mb-1',
        'fieldGroupPreAddonIcon'            : 'cloud-download-alt',
        'fieldGroupPostAddonButtons'        :
            [
                'sync'   : [
                    'title'                   : false,
                    'type'                    : 'primary',
                    'tooltipTitle'            : 'Sync Repository',
                    'icon'                    : 'sync-alt',
                    'noMargin'                : true,
                    'disabled'                : true,
                    'buttonAdditionalClass'   : 'rounded-0',
                    'position'                : 'right'
                ],
                'edit'   : [
                    'title'                   : false,
                    'type'                    : 'warning',
                    'icon'                    : 'edit',
                    'noMargin'                : true,
                    'disabled'                : true,
                    'url'                     : links.url('system/api/q/repository/true/id/0'),
                    'buttonAdditionalClass'   : 'rounded-0 text-white contentAjaxLink disabled',
                    'position'                : 'right'
                ],
                'delete'   : [
                    'title'                   : false,
                    'type'                    : 'danger',
                    'icon'                    : 'trash',
                    'noMargin'                : true,
                    'disabled'                : true,
                    'buttonAdditionalClass'   : 'rounded-0',
                    'position'                : 'right'
                ],
                'add'   : [
                    'title'                   : false,
                    'type'                    : 'success',
                    'icon'                    : 'plus',
                    'noMargin'                : true,
                    'url'                     : links.url('system/api/q/repository/true/id/0'),
                    'buttonAdditionalClass'   : 'rounded-0 contentAjaxLink',
                    'position'                : 'right'
                ]
            ],
        'fieldInputType'                      : 'select',
        'fieldHelp'                           : false,
        'fieldDataSelectOptions'              : repositories,
        'fieldDataSelectOptionsArray'         : true,
        'fieldDataSelectOptionsKey'           : 'id',
        'fieldDataSelectOptionsValue'         : 'name',
        'fieldDataSelectOptionsSelected'      : '0',
        'fieldDataSelectOptionsZero'          : true,
        'fieldDataSelectOptionsZeroTitle'     : 'Select Repository'

    ]
)}}
<script>
/*global PNotify Swal initModuleButtons */
initSync('1');

function initSync(val) {
    $('#{{componentId}}-{{sectionId}}-sync').off();

    changeRepoButtons(val);

    $('#{{componentId}}-{{sectionId}}-sync').click(function() {
        $('#{{componentId}}-{{sectionId}}-sync, ' +
          '#{{componentId}}-{{sectionId}}-delete, ' +
          '#{{componentId}}-{{sectionId}}-add').attr('disabled', true);
        $('#{{componentId}}-{{sectionId}}-edit').addClass('disabled');

        var postData = { };
        postData[$('#security-token').attr('name')] = $('#security-token').val();
        postData['repoId'] = $('#{{componentId}}-{{sectionId}}-repositories option:selected').val();

        $.post('{{links.url("modules/sync")}}', postData, function(response) {
            if (response.tokenKey && response.token) {
                $('#security-token').attr('name', response.tokenKey);
                $('#security-token').val(response.token);
            }
            //eslint-disable-next-line
            console.log(response);
            if (response.responseCode == 0) {
                //
            } else {
                PNotify.error({
                        text        : response.responseMessage,
                        textTrusted : true
                    });
                $('#modules-data').attr('hidden', false);
                $('#modules-loader').attr('hidden', true);
                $('#repository-sync').attr('hidden', true);
                $('#{{componentId}}-{{sectionId}}-sync, #{{componentId}}-{{sectionId}}-edit, #{{componentId}}-{{sectionId}}-delete, #{{componentId}}-{{sectionId}}-add').attr('disabled', false);
            }
        }, 'json');
    });
}

$('#{{componentId}}-{{sectionId}}-repositories').change(function() {
    initSync($(this).val());
});

$('#{{componentId}}-{{sectionId}}-delete').click(function() {
    var repoName = $('#{{componentId}}-{{sectionId}}-repositories option:selected').html();
    var repoId = $('#{{componentId}}-{{sectionId}}-repositories option:selected').val();

    Swal.fire({
        title                       : '<i class="fa text-danger fa-lg fa-question-circle m-2">' +
                                      '</i> <span style="font-size:40px;" class="text-danger"> Delete Repo ' +
                                      repoName + '?</span>',
        icon                        : 'question',
        background                  : 'rgba(0,0,0,.8)',
        backdrop                    : 'rgba(0,0,0,.6)',
        buttonsStyling              : false,
        confirmButtonText           : 'Delete',
        customClass                 : {
            'confirmButton'             : 'btn btn-danger text-uppercase',
            'cancelButton'              : 'ml-2 btn btn-secondary text-uppercase',
        },
        showCancelButton            : true,
        keydownListenerCapture      : true,
        allowOutsideClick           : false,
        allowEscapeKey              : false,
        didOpen                     : function() {
            window.dataCollection.env.sounds.swalSound.play();
        }
    }).then((result) => {
        if (result.isConfirmed) {
            var postData = { };
            postData[$('#security-token').attr('name')] = $('#security-token').val();
            postData['id'] = repoId;

            $.post('{{links.url("repositories/remove")}}', postData,
                    function(response) {
                        if (response.responseCode == 0) {
                            $('#{{componentId}}-{{sectionId}}-repositories').find('[data-value="' + repoId + '"]').remove();
                        } else {
                            PNotify.error({
                                text        : response.responseMessage,
                                textTrusted : true
                            });
                        }
                        if (response.tokenKey && response.token) {
                            $('#security-token').attr('name', response.tokenKey);
                            $('#security-token').val(response.token);
                        }
                    },
                    'json'
                );
        }
    });
});

function changeRepoButtons(val = '0') {
    var url = "{{links.url('system/api/q/repository/true/id/')}}" + val;

    if (val == '1' || val == '2') {
        $('#{{componentId}}-{{sectionId}}-sync').attr('disabled', false);
        $('#{{componentId}}-{{sectionId}}-delete').attr('disabled', true);
        $('#{{componentId}}-{{sectionId}}-edit').removeClass('disabled');
        $('#{{componentId}}-{{sectionId}}-edit').attr('href', url);
    } else if (val == '0') {
        $('#{{componentId}}-{{sectionId}}-sync, #{{componentId}}-{{sectionId}}-delete').attr('disabled', true);
        $('#{{componentId}}-{{sectionId}}-edit').addClass('disabled');
    } else if (val != '1' || val != '2') {
        $('#{{componentId}}-{{sectionId}}-sync, #{{componentId}}-{{sectionId}}-delete').attr('disabled', false);
        $('#{{componentId}}-{{sectionId}}-edit').removeClass('disabled');
        $('#{{componentId}}-{{sectionId}}-edit').attr('href', url);
    }
}
</script>