{{adminltetags.useTag('fields',
    [
        'component'                         : component,
        'componentName'                     : componentName,
        'componentId'                       : 'repositories',
        'sectionId'                         : 'options',
        'parentComponentId'                 : parent,
        'fieldId'                           : 'repositories',
        'fieldLabel'                        : false,
        'fieldType'                         : 'input',
        'fieldAdditionalClass'              : 'mb-1',
        'fieldGroupPreAddonIcon'            : 'cloud-download-alt',
        'fieldGroupPostAddonButtons'        :
            [
                'sync'   : [
                    'title'                   : false,
                    'type'                    : 'primary',
                    'tooltipTitle'            : 'Sync Repository',
                    'icon'                    : 'sync-alt',
                    'noMargin'                : true,
                    'disabled'                : true,
                    'buttonAdditionalClass'   : 'rounded-0',
                    'position'                : 'right'
                ],
                'edit'   : [
                    'title'                   : false,
                    'type'                    : 'warning',
                    'icon'                    : 'edit',
                    'noMargin'                : true,
                    'disabled'                : true,
                    'url'                     : links.url('repositories/q/id/0'),
                    'buttonAdditionalClass'   : 'rounded-0 text-white contentAjaxLink disabled',
                    'position'                : 'right'
                ],
                'delete'   : [
                    'title'                   : false,
                    'type'                    : 'danger',
                    'icon'                    : 'trash',
                    'noMargin'                : true,
                    'disabled'                : true,
                    'buttonAdditionalClass'   : 'rounded-0',
                    'position'                : 'right'
                ],
                'add'   : [
                    'title'                   : false,
                    'type'                    : 'success',
                    'icon'                    : 'plus',
                    'noMargin'                : true,
                    'url'                     : links.url('repositories/q/id/0'),
                    'buttonAdditionalClass'   : 'rounded-0 contentAjaxLink',
                    'position'                : 'right'
                ]
            ],
        'fieldInputType'                      : 'select',
        'fieldHelp'                           : false,
        'fieldDataSelectOptions'              : repositories,
        'fieldDataSelectOptionsArray'         : true,
        'fieldDataSelectOptionsKey'           : 'id',
        'fieldDataSelectOptionsValue'         : 'name',
        'fieldDataSelectOptionsSelected'      : '',
        'fieldDataSelectOptionsZero'          : true,
        'fieldDataSelectOptionsZeroTitle'     : 'Select Repository'
    ]
)}}
<script>
/*global PNotify Swal initModuleButtons */
initSync();

function changeRepoButtons(val = '0') {
    var url = "{{links.url('repositories/q/id/')}}" + val;

    if (val == '1' || val == '2') {
        $('#repositories-options-sync').attr('disabled', false);
        $('#repositories-options-delete').attr('disabled', true);
        $('#repositories-options-edit').removeClass('disabled');
        $('#repositories-options-edit').attr('href', url);
    } else if (val == '0') {
        $('#repositories-options-sync, #repositories-options-delete').attr('disabled', true);
        $('#repositories-options-edit').addClass('disabled');
    } else if (val != '1' || val != '2') {
        $('#repositories-options-sync, #repositories-options-delete').attr('disabled', false);
        $('#repositories-options-edit').removeClass('disabled');
        $('#repositories-options-edit').attr('href', url);
    }
}

function initSync(val) {
    $('#repositories-options-sync').off();

    changeRepoButtons(val);

    $('#repositories-options-sync').click(function() {
        $('#repositories-options-sync, #repositories-options-delete, #repositories-options-add').attr('disabled', true);
        $('#repositories-options-edit').addClass('disabled');
        $('#modules-loader').attr('hidden', true);
        $('#repository-sync').attr('hidden', false);
        $('#modules-data').attr('hidden', true);

        var postData = { };
        postData[$('#security-token').attr('name')] = $('#security-token').val();
        postData['repoId'] = $('#repositories-options-repositories option:selected').val();

        var filterId = $('#filter-options-filter option:selected').val();
        //eslint-disable-next-line
        console.log(filterId);
        $.post('{{links.url("repositories/sync")}}', postData, function(response) {
            if (response.tokenKey && response.token) {
                $('#security-token').attr('name', response.tokenKey);
                $('#security-token').val(response.token);
            }
            if (response.responseCode == 0) {
                //eslint-disable-next-line
                console.log(response);
        //         $('#modules-data').empty().load("{{links.url('modules/q/filter/')}}" + filterId);

        //         $('#modules-data').attr('hidden', false);
        //         $('#modules-loader').attr('hidden', true);
        //         $('#repository-sync').attr('hidden', true);
        //         $('#repositories-options-sync, #repositories-options-edit, #repositories-options-delete, #repositories-options-add').attr('disabled', false);

        //         var text, registerCounter, updateCounter;

        //         registerCounter = response.counter.register;
        //         updateCounter = response.counter.update;

        //         if (registerCounter > 0 || updateCounter > 0) {
        //             if (registerCounter !== 0 && updateCounter === 0) {
        //                 text =
        //                     'Sync Complete.<br>' + registerCounter + ' new modules available.<br> No updates available.';
        //             } else if (registerCounter === 0 && updateCounter !== 0) {
        //                 text =
        //                     'Sync Complete.<br>' + updateCounter + ' new updates available.<br> No new modules available.';
        //             } else if (registerCounter !== 0 && updateCounter !== 0) {
        //                 text =
        //                     'Sync Complete.<br>' + updateCounter + ' new updates available.<br>' + registerCounter + ' new modules available.';
        //             }
        //         } else {
        //             text = 'Sync Complete.<br>No new modules or updates available.';
        //         }
        //         PNotify.info({
        //             text        : text,
        //             textTrusted : true
        //         });

        //         initModuleButtons();
            } else {
                PNotify.error({
                        text        : response.responseMessage,
                        textTrusted : true
                    });
                $('#modules-data').attr('hidden', false);
                $('#modules-loader').attr('hidden', true);
                $('#repository-sync').attr('hidden', true);
                $('#repositories-options-sync, #repositories-options-edit, #repositories-options-delete, #repositories-options-add').attr('disabled', false);
            }
        });
    });
}

$('#repositories-options-repositories').change(function() {
    initSync($(this).val());
});

$('#repositories-options-delete').click(function() {
    var repoName = $('#repositories-options-repositories option:selected').html();
    var repoId = $('#repositories-options-repositories option:selected').val();

    Swal.fire({
        title                       : '<i class="fa text-danger fa-lg fa-question-circle m-2">' +
                                      '</i> <span style="font-size:40px;" class="text-danger"> Delete Repo ' +
                                      repoName + '?</span>',
        icon                        : 'question',
        background                  : 'rgba(0,0,0,.8)',
        backdrop                    : 'rgba(0,0,0,.6)',
        buttonsStyling              : false,
        confirmButtonText           : 'Delete',
        customClass                 : {
            'confirmButton'             : 'btn btn-danger text-uppercase',
            'cancelButton'              : 'ml-2 btn btn-secondary text-uppercase',
        },
        showCancelButton            : true,
        keydownListenerCapture      : true,
        allowOutsideClick           : false,
        allowEscapeKey              : false,
        didOpen                     : function() {
            window.dataCollection.env.sounds.swalSound.play();
        }
    }).then((result) => {
        if (result.isConfirmed) {
            var postData = { };
            postData[$('#security-token').attr('name')] = $('#security-token').val();
            postData['id'] = repoId;

            $.post('{{links.url("repositories/remove")}}', postData,
                    function(response) {
                        if (response.responseCode == 0) {
                            $('#repositories-options-repositories').find('[data-value="' + repoId + '"]').remove();
                        } else {
                            PNotify.error({
                                text        : response.responseMessage,
                                textTrusted : true
                            });
                        }
                        if (response.tokenKey && response.token) {
                            $('#security-token').attr('name', response.tokenKey);
                            $('#security-token').val(response.token);
                        }
                    },
                    'json'
                );
        }
    });
});
</script>