
{% set coreSettingsSecurityPasswordPolicy = 'passwordpolicyoff' %}
{% set passwordPolicyForceReloginAfterPwresetDisabled = true %}
{% set passwordPolicyForcePwresetAfterDisabled = true %}
{% set passwordPolicyBlockPreviousPasswordsDisabled = true %}
{% set passwordPolicyComplexityDisabled = true %}
{% if core['settings']['security']['passwordPolicy'] == 'true' %}
    {% set coreSettingsSecurityPasswordPolicy = 'passwordpolicyon' %}
    {% set passwordPolicyForceReloginAfterPwresetDisabled = false %}
    {% set passwordPolicyForcePwresetAfterDisabled = false %}
    {% set passwordPolicyBlockPreviousPasswordsDisabled = false %}
    {% set passwordPolicyComplexityDisabled = false %}
{% endif %}

{% set passwordPolicyForceReloginAfterPwresetChecked = false %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyForceReloginAfterPwreset'] is defined and core['settings']['security']['passwordPolicySettings']['passwordPolicyForceReloginAfterPwreset'] == 1 %}
    {% set passwordPolicyForceReloginAfterPwresetChecked = true %}
{% endif %}
{% set passwordPolicyForcePwresetAfter = '0' %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyForcePwresetAfter'] is defined %}
    {% set passwordPolicyForcePwresetAfter = core['settings']['security']['passwordPolicySettings']['passwordPolicyForcePwresetAfter'] %}
{% endif %}
{% set passwordPolicyBlockPreviousPasswords = '0' %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyBlockPreviousPasswords'] is defined %}
    {% set passwordPolicyBlockPreviousPasswords = core['settings']['security']['passwordPolicySettings']['passwordPolicyBlockPreviousPasswords'] %}
{% endif %}

{% set passwordPolicyComplexity = '' %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyComplexity'] is defined %}
    {% set passwordPolicyComplexity = core['settings']['security']['passwordPolicySettings']['passwordPolicyComplexity'] %}
{% endif %}

{% set simpleHidden = 'hidden' %}
{% set passwordPolicySimpleAcceptableLevel = '1' %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicySimpleAcceptableLevel'] is defined %}
    {% set passwordPolicySimpleAcceptableLevel = core['settings']['security']['passwordPolicySettings']['passwordPolicySimpleAcceptableLevel'] %}
{% endif %}

{% set complexHidden = 'hidden' %}
{% set passwordPolicyLengthMin = 8 %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyLengthMin'] is defined %}
    {% set passwordPolicyLengthMin = core['settings']['security']['passwordPolicySettings']['passwordPolicyLengthMin'] %}
{% endif %}
{% set passwordPolicyLengthMax = 20 %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyLengthMax'] is defined %}
    {% set passwordPolicyLengthMax = core['settings']['security']['passwordPolicySettings']['passwordPolicyLengthMax'] %}
{% endif %}
{% set passwordPolicyLowercaseChecked = false %}
{% set passwordPolicyUppercaseChecked = false %}
{% set passwordPolicyNumbersChecked = false %}
{% set passwordPolicySymbolsChecked = false %}
{% set passwordPolicyAvoidSimilarChecked = false %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercase'] is defined and core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercase'] == 1 %}
    {% set passwordPolicyLowercaseChecked = true %}
{% endif %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercase'] is defined and core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercase'] == 1 %}
    {% set passwordPolicyUppercaseChecked = true %}
{% endif %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbers'] is defined and core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbers'] == 1 %}
    {% set passwordPolicyNumbersChecked = true %}
{% endif %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicySymbols'] is defined and core['settings']['security']['passwordPolicySettings']['passwordPolicySymbols'] == 1 %}
    {% set passwordPolicySymbolsChecked = true %}
{% endif %}
{% if core['settings']['security']['passwordPolicySettings']['passwordPolicyAvoidSimilar'] is defined and core['settings']['security']['passwordPolicySettings']['passwordPolicyAvoidSimilar'] == 1 %}
    {% set passwordPolicyAvoidSimilarChecked = true %}
{% endif %}
{% set passwordPolicyUppercaseMinCountDisabled = true %}
{% set passwordPolicyUppercaseMaxCountDisabled = true %}
{% set passwordPolicyLowercaseMinCountDisabled = true %}
{% set passwordPolicyLowercaseMaxCountDisabled = true %}
{% set passwordPolicyNumbersMinCountDisabled = true %}
{% set passwordPolicyNumbersMaxCountDisabled = true %}
{% set passwordPolicySymbolsMinCountDisabled = true %}
{% set passwordPolicySymbolsMaxCountDisabled = true %}
{% set passwordPolicyLowercaseIncludeDisabled = true %}
{% set passwordPolicyUppercaseIncludeDisabled = true %}
{% set passwordPolicyNumbersIncludeDisabled = true %}
{% set passwordPolicySymbolsIncludeDisabled = true %}
{% set passwordPolicyAvoidSimilarCharactersDisabled = true %}

{% set passwordPolicyUppercaseMinCount = '2' %}
{% set passwordPolicyUppercaseMaxCount = '' %}
{% set passwordPolicyLowercaseMinCount = '2' %}
{% set passwordPolicyLowercaseMaxCount = '' %}
{% set passwordPolicyNumbersMinCount = '2' %}
{% set passwordPolicyNumbersMaxCount = '' %}
{% set passwordPolicySymbolsMinCount = '2' %}
{% set passwordPolicySymbolsMaxCount = '' %}
{% set passwordPolicyLowercaseInclude = 'abcdefghijklmnopqrstuvwxyz' %}
{% set passwordPolicyUppercaseInclude = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' %}
{% set passwordPolicyNumbersInclude = '0123456789' %}
{% set passwordPolicySymbolsInclude = '!@$%^&*()<>,.?/[]{}-=_+' %}
{% set passwordPolicyAvoidSimilarCharacters = 'iIl1Oo0' %}

{% if passwordPolicyComplexityDisabled === false and passwordPolicyComplexity === 'simple' %}
    {% set simpleHidden = '' %}
{% elseif passwordPolicyComplexityDisabled === false and passwordPolicyComplexity === 'complex' %}
    {% set complexHidden = '' %}

    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercase'] is defined %}
        {% set passwordPolicyUppercase = core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercase'] %}
        {% if passwordPolicyUppercase == 'true' %}
            {% set passwordPolicyUppercaseMinCountDisabled = false %}
            {% set passwordPolicyUppercaseMaxCountDisabled = false %}
            {% set passwordPolicyUppercaseIncludeDisabled = false %}
        {% endif %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercaseMinCount'] is defined %}
        {% set passwordPolicyUppercaseMinCount = core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercaseMinCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercaseMaxCount'] is defined %}
        {% set passwordPolicyUppercaseMaxCount = core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercaseMaxCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercaseInclude'] is defined %}
        {% set passwordPolicyUppercaseInclude = core['settings']['security']['passwordPolicySettings']['passwordPolicyUppercaseInclude'] %}
    {% endif %}

    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercase'] is defined %}
        {% set passwordPolicyLowercase = core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercase'] %}
        {% if passwordPolicyLowercase == 'true' %}
            {% set passwordPolicyLowercaseMinCountDisabled = false %}
            {% set passwordPolicyLowercaseMaxCountDisabled = false %}
            {% set passwordPolicyLowercaseIncludeDisabled = false %}
        {% endif %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercaseMinCount'] is defined %}
        {% set passwordPolicyLowercaseMinCount = core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercaseMinCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercaseMaxCount'] is defined %}
        {% set passwordPolicyLowercaseMaxCount = core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercaseMaxCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercaseInclude'] is defined %}
        {% set passwordPolicyLowercaseInclude = core['settings']['security']['passwordPolicySettings']['passwordPolicyLowercaseInclude'] %}
    {% endif %}

    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbers'] is defined %}
        {% set passwordPolicyNumbers = core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbers'] %}
        {% if passwordPolicyNumbers == 'true' %}
            {% set passwordPolicyNumbersMinCountDisabled = false %}
            {% set passwordPolicyNumbersMaxCountDisabled = false %}
            {% set passwordPolicyNumbersIncludeDisabled = false %}
        {% endif %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbersMinCount'] is defined %}
        {% set passwordPolicyNumbersMinCount = core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbersMinCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbersMaxCount'] is defined %}
        {% set passwordPolicyNumbersMaxCount = core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbersMaxCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbersInclude'] is defined %}
        {% set passwordPolicyNumbersInclude = core['settings']['security']['passwordPolicySettings']['passwordPolicyNumbersInclude'] %}
    {% endif %}

    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicySymbols'] is defined %}
        {% set passwordPolicySymbols = core['settings']['security']['passwordPolicySettings']['passwordPolicySymbols'] %}
        {% if passwordPolicySymbols == 'true' %}
            {% set passwordPolicySymbolsMinCountDisabled = false %}
            {% set passwordPolicySymbolsMaxCountDisabled = false %}
            {% set passwordPolicySymbolsIncludeDisabled = false %}
        {% endif %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicySymbolsMinCount'] is defined %}
        {% set passwordPolicySymbolsMinCount = core['settings']['security']['passwordPolicySettings']['passwordPolicySymbolsMinCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicySymbolsMaxCount'] is defined %}
        {% set passwordPolicySymbolsMaxCount = core['settings']['security']['passwordPolicySettings']['passwordPolicySymbolsMaxCount'] %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicySymbolsInclude'] is defined %}
        {% set passwordPolicySymbolsInclude = core['settings']['security']['passwordPolicySettings']['passwordPolicySymbolsInclude'] %}
    {% endif %}

    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyAvoidSimilar'] is defined %}
        {% set passwordPolicyAvoidSimilar = core['settings']['security']['passwordPolicySettings']['passwordPolicyAvoidSimilar'] %}
        {% if passwordPolicyAvoidSimilar == 'true' %}
            {% set passwordPolicyAvoidSimilarCharactersDisabled = false %}
        {% endif %}
    {% endif %}
    {% if core['settings']['security']['passwordPolicySettings']['passwordPolicyAvoidSimilarCharacters'] is defined %}
        {% set passwordPolicyAvoidSimilarCharacters = core['settings']['security']['passwordPolicySettings']['passwordPolicyAvoidSimilarCharacters'] %}
    {% endif %}
{% endif %}
<div class="row">
    <div class="col">
        {{adminltetags.useTag('fields',
            [
                'component'                      : component,
                'componentName'                  : componentName,
                'componentId'                    : componentId,
                'sectionId'                      : sectionId,
                'fieldId'                        : 'password_policy',
                'fieldLabel'                     : 'Password Policy',
                'fieldType'                      : 'radio',
                'fieldHelp'                      : true,
                'fieldHelpTooltipContent'        : 'Switch on to configure password policy across the platform.',
                'fieldRequired'                  : true,
                'fieldBazJstreeSearch'           : true,
                'fieldBazPostOnUpdate'           : true,
                'fieldBazScan'                   : true,
                'fieldRadioPlacementType'        : 'horizontal',
                'fieldRadioButtons'              :
                    [
                        'passwordpolicyoff' :
                            [
                                'title'                           : 'OFF',
                                'type'                            : 'secondary',
                                'dataValue'                       : 'passwordpolicyoff'
                            ],
                        'passwordpolicyon' :
                            [
                                'title'                           : 'ON',
                                'type'                            : 'primary',
                                'dataValue'                       : 'passwordpolicyon'
                            ]
                    ],
                'fieldRadioChecked'              : coreSettingsSecurityPasswordPolicy
            ]
        )}}
    </div>
    <div class="col">
        {{adminltetags.useTag('fields',
            [
                'component'                             : component,
                'componentName'                         : componentName,
                'componentId'                           : componentId,
                'sectionId'                             : sectionId,
                'fieldId'                               : 'password_policy_force_relogin_after_pwreset',
                'fieldLabel'                            : 'Force Relogin After Password Reset',
                'fieldType'                             : 'checkbox',
                'fieldHelp'                             : true,
                'fieldHelpTooltipContent'               : 'If checked, logged in user will be logged out and redirected to login.',
                'fieldRequired'                         : false,
                'fieldDisabled'                         : false,
                'fieldCheckboxType'                     : 'primary',
                'fieldCheckboxChecked'                  : passwordPolicyForceReloginAfterPwresetChecked,
                'fieldBazPostOnUpdate'                  : true,
                'fieldBazJstreeSearch'                  : true,
                'fieldBazScan'                          : true
            ]
        )}}
    </div>
    <div class="col">
        {{adminltetags.useTag('fields',
            [
                'component'                             : component,
                'componentName'                         : componentName,
                'componentId'                           : componentId,
                'sectionId'                             : sectionId,
                'fieldId'                               : 'password_policy_force_pwreset_after',
                'fieldLabel'                            : 'Force User Password Reset',
                'fieldType'                             : 'input',
                'fieldHelp'                             : true,
                'fieldHelpTooltipContent'               : 'Users should change their password after every x amount of days. 0 means never.',
                'fieldInputTypeTextFilter'              : 'positiveInt',
                'fieldRequired'                         : false,
                'fieldDisabled'                         : passwordPolicyForcePwresetAfterDisabled,
                'fieldBazScan'                          : true,
                'fieldBazJstreeSearch'                  : true,
                'fieldBazPostOnUpdate'                  : true,
                'fieldDataInputMinNumber'               : 0,
                'fieldDataInputMaxNumber'               : 365,
                'fieldValue'                            : passwordPolicyForcePwresetAfter
            ]
        )}}
    </div>
    <div class="col">
        {{adminltetags.useTag('fields',
            [
                'component'                             : component,
                'componentName'                         : componentName,
                'componentId'                           : componentId,
                'sectionId'                             : sectionId,
                'fieldId'                               : 'password_policy_block_previous_passwords',
                'fieldLabel'                            : 'Block previous passwords usage',
                'fieldType'                             : 'input',
                'fieldHelp'                             : true,
                'fieldHelpTooltipContent'               : 'As per the set number, system will keep a track of the password history for the user. New passwords will be checked against the history of those number of passwords and block use of them. 0 means no history is kept.',
                'fieldInputTypeTextFilter'              : 'positiveInt',
                'fieldRequired'                         : false,
                'fieldDisabled'                         : passwordPolicyBlockPreviousPasswordsDisabled,
                'fieldBazScan'                          : true,
                'fieldBazJstreeSearch'                  : true,
                'fieldBazPostOnUpdate'                  : true,
                'fieldDataInputMinNumber'               : 0,
                'fieldDataInputMaxNumber'               : 5,
                'fieldValue'                            : passwordPolicyBlockPreviousPasswords
            ]
        )}}
    </div>
</div>
<div class="row">
    <div class="col">
        {{adminltetags.useTag('fields',
            [
                'component'                             : component,
                'componentName'                         : componentName,
                'componentId'                           : componentId,
                'sectionId'                             : sectionId,
                'fieldId'                               : 'password_policy_complexity',
                'fieldLabel'                            : 'Password Complexity',
                'fieldType'                             : 'select2',
                'fieldHelp'                             : true,
                'fieldHelpTooltipContent'               : 'Select complexity of the password policy.',
                'fieldBazScan'                          : true,
                'fieldRequired'                         : true,
                'fieldDisabled'                         : passwordPolicyComplexityDisabled,
                'fieldBazJstreeSearch'                  : true,
                'fieldBazPostOnUpdate'                  : true,
                'fieldDataSelect2Options'               : availableComplexities,
                'fieldDataSelect2OptionsKey'            : 'id',
                'fieldDataSelect2OptionsValue'          : 'name',
                'fieldDataSelect2OptionsArray'          : true,
                'fieldDataSelect2OptionsSelected'       : passwordPolicyComplexity
            ]
        )}}
    </div>
</div>
{% include 'core/form/settings/security/password/simple.html' %}
{% include 'core/form/settings/security/password/complex.html' %}
<hr>
