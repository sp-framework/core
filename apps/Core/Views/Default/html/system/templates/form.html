{% if template['id'] is defined %}
    {% set templateId = template['id'] %}
    {% set templateName = template['name'] %}
    {% set templateComponentId = template['component_id'] %}
    {% set templateInUse = template['in_use'] %}
    {% set templateDescription = template['description'] %}
    {% set templateHtmlCode = template['html_code'] %}
{% else %}
    {% set templateId = '' %}
    {% set templateName = '' %}
    {% set templateComponentId = '' %}
    {% set templateInUse = '' %}
    {% set templateDescription = '' %}
    {% set templateHtmlCode = '' %}
{% endif %}
<form data-validateon="section" id="{{componentId}}-{{sectionId}}-form">
    <fieldset id="{{componentId}}-{{sectionId}}-fieldset">
        {{adminltetags.useTag('tabs',
            [
                'component'                     : component,
                'componentName'                 : componentName,
                'componentId'                   : componentId,
                'sectionId'                     : 'main',
                'tabsId'                        : 'tabs',
                'tabsStyle'                     : 'card-outline-tabs',
                'tabsData'                      :
                [
                    'info'      :
                    [
                        'tabTitle'          : 'Info',
                        'tabInclude'        : 'templates/form/info',
                        'tabIncludeParams'  :
                            [
                                'templateId'               : templateId,
                                'templateName'             : templateName,
                                'templateComponentId'      : templateComponentId,
                                'templateInUse'            : templateInUse,
                                'templateDescription'      : templateDescription,
                                'templateHtmlCode'         : templateHtmlCode
                            ]
                    ],
                    'rules'  :
                    [
                        'tabTitle'          : 'Test',
                        'tabInclude'        : 'templates/form/test'
                    ]
                ]
            ]
        )}}
    </fieldset>
</form>
<script>
/* globals BazHelpers paginatedPNotify */
var dataCollectionComponent, dataCollectionSection, dataCollectionSectionForm;

if (!window['dataCollection']['{{componentId}}']) {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'] = { };
} else {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'];
}
if (!dataCollectionComponent['{{componentId}}-{{sectionId}}']) {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'] = { };
} else {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'];
}
if (!dataCollectionSection['{{componentId}}-{{sectionId}}-form']) {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'] = { };
} else {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'];
}

dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-id'                                  : { },
        '{{componentId}}-{{sectionId}}-name'                                : { },
        '{{componentId}}-{{sectionId}}-component_id'                        : {
            placeholder: 'SELECT COMPONENT'
        },
        '{{componentId}}-{{sectionId}}-in_use'                              : { },
        '{{componentId}}-{{sectionId}}-description'                         : { },
        '{{componentId}}-{{sectionId}}-html_code'                           : {
            tagsToRemove: ['script', 'link']
        },
        '{{componentId}}-{{sectionId}}-test_data'                           : { },
        '{{componentId}}-{{sectionId}}-result'                              : {
            afterInit: function() {
                $('#{{componentId}}-{{sectionId}}-test-template').click(function(e) {
                    e.preventDefault();

                    $('#{{componentId}}-{{sectionId}}-test-template').children().attr('hidden', false);

                    var url = $(this).attr('href');

                    var postData = { };
                    postData[$('#security-token').attr('name')] = $('#security-token').val();
                    postData['html_code'] = $('#{{componentId}}-{{sectionId}}-html_code').val();
                    postData['test_data'] = $('#{{componentId}}-{{sectionId}}-test_data').val();

                    if (postData['html_code'] === '') {
                        paginatedPNotify('error', {
                            'title' : 'HTML Code cannot be empty.'
                        });

                        $('#{{componentId}}-{{sectionId}}-test-template').children().attr('hidden', true);

                        return;
                    }

                    $.post(url, postData, function(response) {
                        if (response.responseCode == 0) {
                            if (response.responseData && response.responseData.result) {
                                $('#{{componentId}}-{{sectionId}}-result').empty().html(response.responseData.result);
                                $('#{{componentId}}-{{sectionId}}-result').parents('.form-group').removeClass('d-none');
                            }
                        } else {
                            paginatedPNotify('error', {
                                'title' : response.responseMessage
                            });
                        }

                        if (response.tokenKey && response.token) {
                            $('#security-token').attr('name', response.tokenKey);
                            $('#security-token').val(response.token);
                        }

                        $('#{{componentId}}-{{sectionId}}-test-template').children().attr('hidden', true);
                    }, 'json');
                });
            }
        },
        '{{componentId}}-{{sectionId}}-form'                                : {
            rules: {
                '{{componentId}}-{{sectionId}}-name'                        : 'required',
                '{{componentId}}-{{sectionId}}-component_id'                : 'required',
                '{{componentId}}-{{sectionId}}-html_code'                   : 'required',
            },
            messages: {
                '{{componentId}}-{{sectionId}}-name'                        : 'Please enter template name',
                '{{componentId}}-{{sectionId}}-component_id'                : 'Please select component',
                '{{componentId}}-{{sectionId}}-html_code'                   : 'Please enter html code',
            }
        }
    });
</script>