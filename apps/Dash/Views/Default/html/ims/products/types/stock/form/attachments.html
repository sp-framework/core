{% for channelKey, channel in channels %}
    {% if product['images'][channel['id']] is defined %}
        {% set productImages = product['images'][channel['id']] %}
    {% else %}
        {% set productImages = [] %}
    {% endif %}
    {% if product['downloadables'][channel['id']] is defined %}
        {% set productDownloadables = product['downloadables'][channel['id']] %}
    {% else %}
        {% set productDownloadables = [] %}
    {% endif %}
    <div class="row vdivide">
        <div class="col">
            {{adminltetags.useTag('fields',
                [
                    'component'                     : component,
                    'componentName'                 : componentName,
                    'componentId'                   : componentId,
                    'sectionId'                     : sectionId,
                    'fieldId'                       : 'images-' ~ channel['id'],
                    'fieldType'                     : 'files/dropzone',
                    'fieldLabel'                    : false,
                    'fieldDropzoneLabel'            : 'Images ' ~ channel['name'],
                    'fieldRequired'                 : false,
                    'fieldHelp'                     : true,
                    'fieldHelpTooltipContent'       : 'Product images are shown on the product cataloge page on ' ~ channel['name'] ~ '. The first image is used as thumbnail. Max: 10 images.',
                    'fieldBazScan'                  : true,
                    'fieldBazJstreeSearch'          : true,
                    'fieldBazPostOnCreate'          : false,
                    'fieldBazPostOnUpdate'          : false,
                    'attachments'                   : productImages,
                    'maxAttachments'                : 10,
                    'storage'                       : storage,
                    'sortable'                      : true,
                    'upload'                        : true,
                    'allowedUploads'                : 'images'
                ]
            )}}
        </div>
        <div class="col">
            {{adminltetags.useTag('fields',
                [
                    'component'                     : component,
                    'componentName'                 : componentName,
                    'componentId'                   : componentId,
                    'sectionId'                     : sectionId,
                    'fieldId'                       : 'downloadables-' ~ channel['id'],
                    'fieldType'                     : 'files/dropzone',
                    'fieldLabel'                    : false,
                    'fieldDropzoneLabel'            : 'Downloadables ' ~ channel['name'],
                    'fieldRequired'                 : false,
                    'fieldHelp'                     : true,
                    'fieldHelpTooltipContent'       : 'You can attach downloadable files here. Example: Product manuals, Service guides, etc. They will show on the product page of channel ' ~ channel['name'] ~ '. Max: 10 attachments.',
                    'fieldBazScan'                  : true,
                    'fieldBazJstreeSearch'          : true,
                    'fieldBazPostOnCreate'          : false,
                    'fieldBazPostOnUpdate'          : false,
                    'attachments'                   : productDownloadables,
                    'maxAttachments'                : 10,
                    'storage'                       : storage,
                    'sortable'                      : false,
                    'upload'                        : true,
                    'allowedUploads'                : 'files'
                ]
            )}}
        </div>
    </div>
{% endfor %}
{% set attachmentChannels = json_encode(channels, 16) %}
{{adminltetags.useTag('fields',
    [
        'component'                      : component,
        'componentName'                  : componentName,
        'componentId'                    : componentId,
        'sectionId'                      : sectionId,
        'fieldId'                        : 'images',
        'fieldLabel'                     : false,
        'fieldType'                      : 'html',
        'fieldHelp'                      : false,
        'fieldHelpTooltipContent'        : 'Images assigned to different channels.',
        'fieldAdditionalClass'           : 'mb-0',
        'fieldBazScan'                   : true,
        'fieldBazJstreeSearch'           : false,
        'fieldBazPostOnCreate'           : true,
        'fieldBazPostOnUpdate'           : true
    ]
)}}
{{adminltetags.useTag('fields',
    [
        'component'                      : component,
        'componentName'                  : componentName,
        'componentId'                    : componentId,
        'sectionId'                      : sectionId,
        'fieldId'                        : 'downloadables',
        'fieldLabel'                     : false,
        'fieldType'                      : 'html',
        'fieldHelp'                      : false,
        'fieldHelpTooltipContent'        : 'Downloadables assigned to different channels.',
        'fieldAdditionalClass'           : 'mb-0',
        'fieldBazScan'                   : true,
        'fieldBazJstreeSearch'           : false,
        'fieldBazPostOnCreate'           : true,
        'fieldBazPostOnUpdate'           : true
    ]
)}}
<script>
/* globals dataCollectionSection */
if (!dataCollectionSection["data"]) {
    dataCollectionSection["data"] = { };
}
if (!dataCollectionSection["data"]['images']) {
    dataCollectionSection["data"]['images'] = { };
}
if (!dataCollectionSection["data"]['downloadables']) {
    dataCollectionSection["data"]['downloadables'] = { };
}

var attachmentChannels = JSON.parse('{{attachmentChannels}}');

dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-images'                  : {
            afterInit: function() {
                for (var channel in attachmentChannels) {
                    dataCollectionSection["data"]['images'][attachmentChannels[channel]['id']]
                        = dataCollectionSection["data"]['images-' + attachmentChannels[channel]['id']];
                }
            },
            afterExtract: function() {
                for (var channel in attachmentChannels) {
                    dataCollectionSection["data"]['images'][attachmentChannels[channel]['id']]
                        = dataCollectionSection["data"]['images-' + attachmentChannels[channel]['id']];
                }
            }
        },
        '{{componentId}}-{{sectionId}}-downloadables'           : {
            afterInit: function() {
                for (var channel in attachmentChannels) {
                    dataCollectionSection["data"]['downloadables'][attachmentChannels[channel]['id']]
                        = dataCollectionSection["data"]['downloadables-' + attachmentChannels[channel]['id']];
                }
            },
            afterExtract: function() {
                for (var channel in attachmentChannels) {
                    dataCollectionSection["data"]['downloadables'][attachmentChannels[channel]['id']]
                        = dataCollectionSection["data"]['downloadables-' + attachmentChannels[channel]['id']];
                }
            }
        }
    });
</script>