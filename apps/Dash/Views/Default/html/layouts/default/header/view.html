<input id="security-token" type="hidden" name="{{security.getTokenKey()}}" value="{{security.getToken()}}">
<nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <div class="container-fluid">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a id="push-menu" data-widget="pushmenu" class="nav-link" role="button" href="#"><i class="fas fa-bars"></i></a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li id="profile-dropdown" class="nav-item dropdown">
                {% if auth.account() %}
                    {% set profile = auth.account()['profile'] %}
                    <a id="profile-portrait" class="nav-link" data-toggle="dropdown" href="#" aria-expanded="true">
                        {% if profile['portrait'] is defined and profile['portrait'] !== '' %}
                            <img src="{{links.url('system/storages/q/uuid/' ~ profile['portrait'] ~ '/w/30')}}" class="rounded-sm" style="position:relative;top: -5px;" alt="User Image">
                            <i class="far fa-user" hidden></i>
                        {% else %}
                            <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" class="rounded-sm" style="position:relative;top: -5px;" alt="User Image" hidden>
                            <i class="far fa-user"></i>
                        {% endif %}
                    </a>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a href="{{links.url('system/users/profile')}}" id="profile" class="dropdown-item contentAjaxLink">
                            <i class="fa fa-id-card mr-2"></i> Profile
                        </a>
                        <a href="{{links.url('auth/logout')}}" id="logout" class="dropdown-item">
                            <i class="fa fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                {% endif %}
            </li>
            <li class="nav-item">
                {% if auth.account()['profile']['settings']['notifications']['mute'] is defined %}
                    {% if auth.account()['profile']['settings']['notifications']['mute'] == true %}
                        {% set notificationIcon = 'bell-slash' %}
                    {% elseif auth.account()['profile']['settings']['notifications']['mute'] == false %}
                        {% set notificationIcon = 'bell' %}
                    {% else %}
                        {% set notificationIcon = 'bell' %}
                    {% endif %}
                {% else %}
                    {% set notificationIcon = 'bell' %}
                {% endif %}
                <a id="notifications-button" class="nav-link contentAjaxLink" href="{{links.url('system/notifications')}}" role="button">
                    <i class="far fa-fw fa-{{notificationIcon}}"></i>
                    <span id="notifications-button-counter" class="badge badge-info navbar-badge"></span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
                    <i class="fas fa-th-large"></i>
                </a>
            </li>
        </ul>
    </div>
</nav>
<script>
/* globals BazCore */
$('#logout').click(function(e) {
    e.preventDefault();
    var url = $(this).attr('href');

    var postData = { };
    var tokenKey = $('.token').attr('name');
    var token = $('.token').val();
    postData[tokenKey] = token;
    $.post(url, postData, function(data) {
        if (data.responseCode == '0') {
            if (data.redirectUrl) {
                window.location = data.redirectUrl;
            } else {
                window.location = '/';
            }
        }
    }, 'json');
});

$('body').on('bazContentLoaderInitComplete', function() {
    $('#notifications-button').click(function(e) {
        e.preventDefault();
        BazCore.getNotificationsCount();
    });
});
</script>