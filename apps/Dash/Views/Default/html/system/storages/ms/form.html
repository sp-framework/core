<form data-validateon="section" id="{{componentId}}-{{sectionId}}-form">
    <fieldset id="{{componentId}}-{{sectionId}}-fieldset">
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'modules',
                        'fieldLabel'                     : 'Select Module',
                        'fieldType'                      : 'select2',
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Select module to view/change settings.',
                        'fieldBazScan'                   : true,
                        'fieldRequired'                  : true,
                        'fieldBazPostOnUpdate'           : true,
                        'fieldDataSelect2Options'        : usedModules,
                        'fieldDataSelect2OptionsKey'     : 'id',
                        'fieldDataSelect2OptionsValue'   : 'name',
                        'fieldDataSelect2OptionsSelected': ''
                    ]
                )}}
            </div>
        </div>
    </fieldset>
</form>
{% set usedModules = json_encode(usedModules, 16) %}
<script>
/* globals PNotify Swal dataCollection */
var dataCollectionComponent, dataCollectionSection, dataCollectionSectionForm;

if (!window['dataCollection']['{{componentId}}']) {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'] = { };
} else {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'];
}
if (!dataCollectionComponent['{{componentId}}-{{sectionId}}']) {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'] = { };
} else {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'];
}
if (!dataCollectionSection['{{componentId}}-{{sectionId}}-form']) {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'] = { };
} else {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'];
}

dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-modules'                              : {
            placeholder : 'SELECT MODULE TO VIEW/UPDATE',
            afterInit: function() {
                var usedModules = { };
                usedModules = JSON.parse('{{usedModules}}');

                $('#{{componentId}}-{{sectionId}}-updateData').attr('disabled', true);

                $('#{{componentId}}-{{sectionId}}-modules').on('select2:select', function(e) {
                    $('#{{componentId}}-{{sectionId}}-updateData').attr('disabled', false);
                    var id = e.params.data.id;

                    var label = $(e.params.data.element).parents('optgroup').attr('label').toLowerCase();
                    //eslint-disable-next-line
                    console.log(label, usedModules);
                    if (usedModules[label]['childs'][id]['settings']) {
                        //eslint-disable-next-line
                        console.log(usedModules[label]['childs'][id]['settings']);
                    }
                });
            }
        },
        '{{componentId}}-{{sectionId}}-form'                            : {
            ignore: ':submit, :reset, :image, :disabled, .ignore, .cr-slider',
            rules: {
                '{{componentId}}-{{sectionId}}-default_dashboard'           : 'required'
            },
            messages: {
                '{{componentId}}-{{sectionId}}-default_dashboard'       : 'Please select default dashboard'
            }
        }
    });
</script>