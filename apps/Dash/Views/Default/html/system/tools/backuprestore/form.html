<form autocomplete="off" data-validateon="section" id="{{componentId}}-{{sectionId}}-form">
    <fieldset id="{{componentId}}-{{sectionId}}-fieldset">
        {{adminltetags.useTag('tabs',
            [
                'component'                     : component,
                'componentName'                 : componentName,
                'componentId'                   : componentId,
                'sectionId'                     : 'main',
                'tabsId'                        : 'tabs',
                'tabsStyle'                     : 'card-outline-tabs',
                'tabsData'                      :
                    [
                        'backup'   :
                        [
                            'tabTitle'          : 'Backup',
                            'tabInclude'        : 'backuprestore/form/backup'
                        ],
                        'restore'   :
                        [
                            'tabTitle'          : 'Restore',
                            'tabInclude'        : 'backuprestore/form/restore'
                        ]
                    ]
            ]
        )}}
    </fieldset>
</form>
<div>
    {{adminltetags.useTag('modal',
        [
            'component'                 : component,
            'componentName'             : componentName,
            'componentId'               : componentId,
            'sectionId'                 : sectionId,
            'modalId'                   : 'restore-analyse-modal',
            'modalBodyInclude'          : 'backuprestore/analyse/view',
            'modalSize'                 : 'xl',
            'modalHeader'               : true,
            'modalFooter'               : true,
            'modalTitle'                : '<i class="fa fas fa-fw fa-file-zipper"></i> ANALYSE BACKUP',
            'modalFooterButtons'        :
                [
                'component'                     : component,
                'componentName'                 : componentName,
                'componentId'                   : componentId,
                'parentComponentId'             : parent,
                'sectionId'                     : sectionId,
                'buttonType'                    : 'button',
                'buttons'                       :
                        [
                            'modal-button-restore' : [
                                'title'                   : 'Restore',
                                'type'                    : 'primary',
                                'position'                : 'right',
                                'disabled'                : true,
                                'icon'                    : 'cog fa-spin',
                                'iconHidden'              : true
                            ]
                        ]
                ]
        ]
    )}}
</div>
<script>
/* globals PNotify Swal */
var dataCollectionComponent, dataCollectionSection, dataCollectionSectionForm;

if (!window['dataCollection']['{{componentId}}']) {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'] = { };
} else {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'];
}
if (!dataCollectionComponent['{{componentId}}-{{sectionId}}']) {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'] = { };
} else {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'];
}
if (!dataCollectionSection['{{componentId}}-{{sectionId}}-form']) {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'] = { };
} else {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'];
}

dataCollectionSectionForm['vars'] = { };
dataCollectionSectionForm['funcs'] = { };

dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-apps_dir'                                : { },
        '{{componentId}}-{{sectionId}}-systems_dir'                             : { },
        '{{componentId}}-{{sectionId}}-public_dir'                              : { },
        '{{componentId}}-{{sectionId}}-private_dir'                             : { },
        '{{componentId}}-{{sectionId}}-external_dir'                            : { },
        '{{componentId}}-{{sectionId}}-html_compiled'                           : { },
        '{{componentId}}-{{sectionId}}-var_dir'                                 : { },
        '{{componentId}}-{{sectionId}}-external_vendor_dir'                     : {
            afterInit : function() {
                $('#{{componentId}}-{{sectionId}}-external_vendor_dir').click(function() {
                    if ($(this)[0].checked === true) {
                        $('#{{componentId}}-{{sectionId}}-external_dir')[0].checked = true;
                        $('#{{componentId}}-{{sectionId}}-external_dir').attr('disabled', true);
                    } else {
                        $('#{{componentId}}-{{sectionId}}-external_dir').attr('disabled', false);
                    }
                });
            }
        },
        '{{componentId}}-{{sectionId}}-old_backups'                             : { },
        '{{componentId}}-{{sectionId}}-database'                                : { },
        '{{componentId}}-{{sectionId}}-keys'                                    : {
            afterInit : function() {
                $('#{{componentId}}-{{sectionId}}-keys').click(function() {
                    if ($(this)[0].checked === true) {
                        $('#{{componentId}}-{{sectionId}}-encryption_passphrase').attr('disabled', false);
                        $('#{{componentId}}-{{sectionId}}-systems_dir').attr('disabled', true);
                        $('#{{componentId}}-{{sectionId}}-systems_dir')[0].checked = true;
                    } else {
                        $('#{{componentId}}-{{sectionId}}-encryption_passphrase').attr('disabled', true);
                        $('#{{componentId}}-{{sectionId}}-encryption_passphrase').val('');
                        $('#{{componentId}}-{{sectionId}}-systems_dir').attr('disabled', false);
                    }
                });
            }
        },
        '{{componentId}}-{{sectionId}}-encryption_passphrase'                   : {
            afterInit : function() {
                $('#{{componentId}}-{{sectionId}}-passphrase_generate').click(function(e) {
                    e.preventDefault();

                    var postData = { };
                    postData[$('#security-token').attr('name')] = $('#security-token').val();

                    $.post('{{links.url("system/tools/backuprestore/generatePassphrase")}}', postData, function(response) {
                        if (response.responseCode == 0) {
                            if (response.responseData.passphrase) {
                                $('#{{componentId}}-{{sectionId}}-encryption_passphrase').val(response.responseData.passphrase).trigger('change');
                            }
                        } else {
                            PNotify.error(response.responseMessage);
                        }
                        if (response.tokenKey && response.token) {
                            $("#security-token").attr("name", response.tokenKey);
                            $("#security-token").val(response.token);
                        }
                    }, 'json');
                });
            }
        },
        '{{componentId}}-{{sectionId}}-strength-meter'                          : {
            afterInit : function() {
                $('#{{componentId}}-{{sectionId}}-strength-meter').off();
                $('#{{componentId}}-{{sectionId}}-strength-meter').strengthMeter({
                    "url" : '{{links.url("system/tools/backuprestore/checkPassphraseStrength")}}'
                });
            }
        },
        '{{componentId}}-{{sectionId}}-db_drop'                                 : { },
        '{{componentId}}-{{sectionId}}-restore_root_username'                   : { },
        '{{componentId}}-{{sectionId}}-restore_root_password'                   : { },
        '{{componentId}}-{{sectionId}}-restore_db_name'                         : { },
        '{{componentId}}-{{sectionId}}-restore_charset'                         : { },
        '{{componentId}}-{{sectionId}}-restore_collation'                       : { },
        '{{componentId}}-{{sectionId}}-restore_db_username'                     : { },
        '{{componentId}}-{{sectionId}}-restore_db_password'                     : {
            afterInit : function() {
                // $('#{{componentId}}-{{sectionId}}-restore_db_password_generate').click(function(e) {
                //     e.preventDefault();

                //     var postData = { };
                //     postData[$('#security-token').attr('name')] = $('#security-token').val();

                //     $.post('{{links.url("system/tools/backuprestore/generatePw")}}', postData, function(response) {
                //         if (response.responseCode == 0) {
                //             if (response.responseData.password) {
                //                 $('#{{componentId}}-{{sectionId}}-restore_db_password').val(response.responseData.password).trigger('change');
                //                 $('#{{componentId}}-{{sectionId}}-restore_db_password').attr('type', 'text');
                //             }
                //         } else {
                //             PNotify.error(response.responseMessage);
                //         }
                //         if (response.tokenKey && response.token) {
                //             $("#security-token").attr("name", response.tokenKey);
                //             $("#security-token").val(response.token);
                //         }
                //         $('#{{componentId}}-{{sectionId}}-restore_db_password').keyup(function() {
                //             if ($(this).val() === '') {
                //                 $(this).attr('type', 'password');
                //             }
                //         });
                //     }, 'json');
                // });
            }
        },
        '{{componentId}}-{{sectionId}}-restore_db_password_strength_meter'      : {
            afterInit : function() {
                // $('#{{componentId}}-{{sectionId}}-restore_db_password_strength_meter').strengthMeter({
                //     "url"       : '{{links.url("system/core/checkPwStrength")}}',
                //     "postData"  : {
                //         "session"           : $('#session-token').val()
                //     }
                // });
            }
        },
        '{{componentId}}-{{sectionId}}-backups'                                 : {
            placeholder : "SELECT DATABASE TO RESTORE",
            allowClear  : true,
            afterInit   : function() {
                $('#{{componentId}}-{{sectionId}}-backups').on('select2:select', function(e) {
                    dataCollectionSectionForm['funcs']['addedNewBackupOption'](e.params.data.id, e.params.data.text);
                });

                $('#{{componentId}}-{{sectionId}}-backups').on('select2:clear', function(e) {
                    dataCollectionSectionForm['funcs']['clearFields']('remove');
                });

                function generateBackup() {
                    // $('#{{componentId}}-{{sectionId}}-backup').attr('disabled', true);
                    // $('#{{componentId}}-{{sectionId}}-backup').children('i').attr('hidden', false);

                    var postData = { };
                    postData[$('#security-token').attr('name')] = $('#security-token').val();
                    postData['apps_dir'] = $('#{{componentId}}-{{sectionId}}-apps_dir')[0].checked;
                    postData['systems_dir'] = $('#{{componentId}}-{{sectionId}}-systems_dir')[0].checked;
                    postData['public_dir'] = $('#{{componentId}}-{{sectionId}}-public_dir')[0].checked;
                    postData['private_dir'] = $('#{{componentId}}-{{sectionId}}-private_dir')[0].checked;
                    postData['html_compiled'] = $('#{{componentId}}-{{sectionId}}-html_compiled')[0].checked;
                    postData['var_dir'] = $('#{{componentId}}-{{sectionId}}-var_dir')[0].checked;
                    postData['external_dir'] = $('#{{componentId}}-{{sectionId}}-external_dir')[0].checked;
                    postData['external_vendor_dir'] = $('#{{componentId}}-{{sectionId}}-external_vendor_dir')[0].checked;
                    postData['old_backups'] = $('#{{componentId}}-{{sectionId}}-old_backups')[0].checked;
                    postData['database'] = $('#{{componentId}}-{{sectionId}}-database')[0].checked;
                    postData['keys'] = $('#{{componentId}}-{{sectionId}}-keys')[0].checked;
                    if ($('#{{componentId}}-{{sectionId}}-keys')[0].checked === true) {
                        postData['encryption_passphrase'] = $('#{{componentId}}-{{sectionId}}-encryption_passphrase').val();
                    }

                    $.post('{{links.url("system/tools/backuprestore/backup")}}', postData, function(response) {
                        if (response.tokenKey && response.token) {
                            $('#security-token').attr('name', response.tokenKey);
                            $('#security-token').val(response.token);
                        }

                        if (response.responseCode == 0) {
                            PNotify.success({text : response.responseMessage});

                            var data = {
                                id: response.responseData['uuid'],
                                text: response.responseData['filename']
                            };

                            var newOption = new Option(data.text, data.id, false, false);
                            $('#{{componentId}}-{{sectionId}}-backups').append(newOption).val(data.id).trigger('change');
                            dataCollectionSectionForm['funcs']['addedNewBackupOption'](data.id, data.text);

                            $('#{{componentId}}-{{sectionId}}-backup').attr('disabled', false);
                            $('#{{componentId}}-{{sectionId}}-backup').children('i').attr('hidden', true);
                        } else {
                            PNotify.error({text : response.responseMessage});
                        }
                    }, 'json');
                }

                $('#{{componentId}}-{{sectionId}}-backup').off();
                $('#{{componentId}}-{{sectionId}}-backup').click(function(e) {
                    e.preventDefault();

                    generateBackup();
                });
            }
        },
        '{{componentId}}-{{sectionId}}-backup_structure'                        : { },
        '{{componentId}}-{{sectionId}}-form'                                    : $.extend(dataCollectionSectionForm, {
            rules: {
            },
            messages: {
            },
            onSubmit : function() {
                return true;
            }
        })
    });

var swalSound = window['dataCollection'].env.sounds.swalSound;

dataCollectionSectionForm['funcs']['clearFields'] = function(fields = 'restore', clear = true) {
    $('#restore-fields').attr('hidden', true);
    $('#{{componentId}}-{{sectionId}}-restore_db_username, ' +
      '#{{componentId}}-{{sectionId}}-restore_db_password, ' +
      '#{{componentId}}-{{sectionId}}-restore_root_username, ' +
      '#{{componentId}}-{{sectionId}}-restore_root_password').val('');
    $('#{{componentId}}-{{sectionId}}-db_drop')[0].checked = false;

    if (clear) {
        $('#{{componentId}}-{{sectionId}}-restore, #{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
        $('#{{componentId}}-{{sectionId}}-download').addClass('disabled');
        $('#{{componentId}}-{{sectionId}}-download').attr('href', '#');
        $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
    }
}

dataCollectionSectionForm['funcs']['addedNewBackupOption'] = function(id, text) {
    dataCollectionSectionForm['funcs']['clearFields']('restore', false);
    $('#{{componentId}}-{{sectionId}}-restore').attr('disabled', false);
    $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', false);
    $('#{{componentId}}-{{sectionId}}-restore, #{{componentId}}-{{sectionId}}-remove').attr('disabled', false);
    $('#{{componentId}}-{{sectionId}}-download').removeClass('disabled');
    $('#{{componentId}}-{{sectionId}}-download').attr('href', '{{links.url("system/storages/q/uuid/' + id + '")}}');

    $('#{{componentId}}-{{sectionId}}-remove').off();
    $('#{{componentId}}-{{sectionId}}-remove').click(function(e) {
        e.preventDefault();

        Swal.fire({
            title                       : '<span class="text-danger"> Remove restore file from system?</span>',
            icon                        : 'question',
            background                  : 'rgba(0,0,0,.8)',
            backdrop                    : 'rgba(0,0,0,.6)',
            buttonsStyling              : false,
            confirmButtonText           : 'Remove',
            customClass                 : {
                'confirmButton'             : 'btn btn-danger text-uppercase',
                'cancelButton'              : 'ml-2 btn btn-secondary text-uppercase',
            },
            showCancelButton            : true,
            keydownListenerCapture      : true,
            allowOutsideClick           : true,
            allowEscapeKey              : true,
            didOpen                     : function() {
                swalSound.play();
            }
        }).then((result) => {
            if (result.value) {
                var postData = { };
                postData['uuid'] = id;
                postData[$('#security-token').attr('name')] = $('#security-token').val();

                $.post('{{links.url("system/storages/remove")}}', postData, function(response) {
                    if (response.tokenKey && response.token) {
                        $('#security-token').attr('name', response.tokenKey);
                        $('#security-token').val(response.token);
                    }

                    if (response.responseCode == 0) {
                        PNotify.success({text : response.responseMessage});

                        $('#{{componentId}}-{{sectionId}}-backups option[value="' + id + '"]').remove();
                        $('#{{componentId}}-{{sectionId}}-restore, #{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
                        $('#{{componentId}}-{{sectionId}}-download').addClass('disabled');
                        $('#{{componentId}}-{{sectionId}}-download').attr('href', '#');
                    }
                }, 'json');
            }
        });
    });

    $('#{{componentId}}-{{sectionId}}-restore').off();
    $('#{{componentId}}-{{sectionId}}-restore').click(function(e) {
        e.preventDefault();

        $('#{{componentId}}-{{sectionId}}-restore-analyse-modal').modal('show');
        var url = '{{links.url("system/tools/backuprestore/q/analyse/info/id/' + id + '")}}';

        $('#{{componentId}}-{{sectionId}}-analyse-info').load(url, null, function (response, status, xhr) {
            if (xhr.getResponseHeader('tokenKey') && xhr.getResponseHeader('token')) {
                $('#security-token').attr('name', xhr.getResponseHeader('tokenKey'));
                $('#security-token').val(xhr.getResponseHeader('token'));
            }

            if (status === 'success') {
                $('#{{componentId}}-{{sectionId}}-analyse-info').empty().html(response);
                $(document).ready(function() {
                    $('#{{componentId}}-{{sectionId}}-analyse-info').attr('hidden', false);
                    $('#{{componentId}}-{{sectionId}}-modal-button-add').attr('disabled', false);
                    $('#{{componentId}}-{{sectionId}}-analyse-loader').attr('hidden', true);
                });
                //eslint-disable-next-line
                // console.log(response, status, xhr);
            } else {
            //     $('#{{componentId}}-{{sectionId}}-analyse-error').attr('hidden', false);
            //     $('#{{componentId}}-{{sectionId}}-modal-button-add').attr('disabled', true);
            }
        });
        // $(this).attr('disabled', true);
        // $('#restore-fields').attr('hidden', false);
        // $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
        // var dbname = $('#{{componentId}}-{{sectionId}}-backups').find(':selected').text().trim().slice(0, -4);
        // var dbUsername = dbname + 'User';
        // $('#{{componentId}}-{{sectionId}}-restore_db_name').val(dbname);
        // $('#{{componentId}}-{{sectionId}}-restore_charset').val('utf8mb4');
        // $('#{{componentId}}-{{sectionId}}-restore_collation').val('utf8mb4_general_ci');
        // $('#{{componentId}}-{{sectionId}}-restore_db_username').val(dbUsername);
    });

    $('#{{componentId}}-{{sectionId}}-cancel-restore').off();
    $('#{{componentId}}-{{sectionId}}-cancel-restore').click(function(e) {
        e.preventDefault();

        dataCollectionSectionForm['funcs']['clearFields']('restore', false);
    });
    $('#{{componentId}}-{{sectionId}}-start-restore').off();
    $('#{{componentId}}-{{sectionId}}-start-restore').click(function(e) {
        e.preventDefault();

        if ($('#{{componentId}}-{{sectionId}}-restore_db_name').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_db_name').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_db_name').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_charset').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_charset').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_charset').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_collation').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_collation').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_collation').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_db_username').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_db_username').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_db_username').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_db_password').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_db_password').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_db_password').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_root_username').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_root_username').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_root_username').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_root_password').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_root_password').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_root_password').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else {
            $(this).attr('disabled', true);
            $(this).children('i').attr('hidden', false);

            var postData = { };
            postData['filename'] = text;
            postData['dbname'] = $('#{{componentId}}-{{sectionId}}-restore_db_name').val();
            postData['charset'] = $('#{{componentId}}-{{sectionId}}-restore_charset').val();
            postData['collation'] = $('#{{componentId}}-{{sectionId}}-restore_collation').val();
            postData['username'] = $('#{{componentId}}-{{sectionId}}-restore_db_username').val();
            postData['password'] = $('#{{componentId}}-{{sectionId}}-restore_db_password').val();
            postData['root_username'] = $('#{{componentId}}-{{sectionId}}-restore_root_username').val();
            postData['root_password'] = $('#{{componentId}}-{{sectionId}}-restore_root_password').val();
            postData['drop'] = $('#{{componentId}}-{{sectionId}}_drop')[0].checked;
            postData[$('#security-token').attr('name')] = $('#security-token').val();

            $.post('{{links.url("system/tools/backuprestore/restore")}}', postData, function(response) {
                if (response.tokenKey && response.token) {
                    $('#security-token').attr('name', response.tokenKey);
                    $('#security-token').val(response.token);
                }

                if (response.responseCode == 0) {
                    PNotify.success({text : response.responseMessage});

                    dataCollectionSectionForm['vars']['dbs'][response.responseData.newDb.dbname] = response.responseData.newDb;

                    var newOption = new Option(response.responseData.newDb.dbname, response.responseData.newDb.dbname, false, false);
                    $('#{{componentId}}-{{sectionId}}-alldbs').append(newOption).val(response.responseData.newDb.dbname).trigger('change');
                    dataCollectionSectionForm['funcs']['clearFields']('restore');
                    $('#{{componentId}}-{{sectionId}}-backups').val(null).trigger('change');
                    $('#{{componentId}}-{{sectionId}}-is_active')[0].checked = false;
                    $('#{{componentId}}-{{sectionId}}-is_active').attr('disabled', false);
                    $('.generate-backup-span').html('<i class="fas fa-fw fa-cog fa-spin" hidden=""></i> Backup ' + response.responseData.newDb.dbname + ' db');
                    $('.update-span').html('<i class="fas fa-fw fa-cog fa-spin" hidden=""></i> Update ' + response.responseData.newDb.dbname + ' db');
                    $('.delete-span').html('<i class="fas fa-fw fa-cog fa-spin" hidden=""></i> Remove ' + response.responseData.newDb.dbname + ' db');
                    $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
                    $('#{{componentId}}-{{sectionId}}-download').attr('disabled', true);
                    $('#{{componentId}}-{{sectionId}}-restore').attr('disabled', true);
                    $('#{{componentId}}-{{sectionId}}-backup').attr('disabled', false);
                    $('#{{componentId}}-{{sectionId}}-update').attr('disabled', false);
                    $('#{{componentId}}-{{sectionId}}-delete').attr('disabled', false);
                    $('#{{componentId}}-{{sectionId}}_host').val(response.responseData.newDb.host);
                    $('#{{componentId}}-{{sectionId}}_port').val(response.responseData.newDb.port);
                    $('#{{componentId}}-{{sectionId}}_name').val(response.responseData.newDb.dbname);
                    $('#{{componentId}}-{{sectionId}}_charset').val(response.responseData.newDb.charset);
                    $('#{{componentId}}-{{sectionId}}_collation').val(response.responseData.newDb.collation);
                    $('#{{componentId}}-{{sectionId}}_username').val(response.responseData.newDb.username);
                    $('#{{componentId}}-{{sectionId}}_password').val('');
                } else {
                    PNotify.error({text : response.responseMessage});
                }
                $('#{{componentId}}-{{sectionId}}-start-restore').attr('disabled', false);
                $('#{{componentId}}-{{sectionId}}-start-restore').children('i').attr('hidden', true);
            }, 'json');
        }
    });
}

$('#body').on('dropzoneInitDone', function() {
    dataCollectionSection['admin-backuprestore-main-upload_restore']['onSuccess'] = function(file, response) {
        if (response.responseData && response.responseData.name && response.responseData.uuid) {
            var newOption = new Option(response.responseData.name, response.responseData.uuid, false, false);
            $('#{{componentId}}-{{sectionId}}-backups').append(newOption).val(response.responseData.uuid).trigger('change');
            dataCollectionSectionForm['funcs']['addedNewBackupOption'](response.responseData.uuid, response.responseData.name);
            PNotify.success({text: 'File ' + response.responseData.name + ' uploaded and ready to be restored.'});
            dataCollectionSection['admin-backuprestore-main-upload_restore']['reset']();
        }
    };
});
</script>