<div class="row vdivide">
    <div class="col">
        <legend>BACKUP</legend>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'apps_dir',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup apps directory?',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'success',
                        'fieldCheckboxLabel'             : 'BACKUP APPS DIRECTORY',
                        'fieldCheckboxChecked'           : true,
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'systems_dir',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup systems directory?',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'success',
                        'fieldCheckboxLabel'             : 'BACKUP SYSTEMS DIRECTORY',
                        'fieldCheckboxChecked'           : true,
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'public_dir',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup public directory?',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'success',
                        'fieldCheckboxLabel'             : 'BACKUP PUBLIC DIRECTORY',
                        'fieldCheckboxChecked'           : true,
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'private_dir',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup private directory?',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'success',
                        'fieldCheckboxLabel'             : 'BACKUP PRIVATE DIRECTORY',
                        'fieldCheckboxChecked'           : true,
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'external_dir',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup external (third party) directory? It includes only composer files. If you want to backup whole vendor folder, select Backup External Vendor Directory option as well.',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'success',
                        'fieldCheckboxLabel'             : 'BACKUP EXTERNAL DIRECTORY',
                        'fieldCheckboxChecked'           : true,
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'html_compiled',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Compiled Templates Directory? Note: This can be regenerated.',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'warning',
                        'fieldCheckboxChecked'           : false,
                        'fieldCheckboxLabel'             : 'COMPILED HTML DIRECTORY',
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'var_dir',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup var (variable) directory? This directory contains logs, cache, session information. Information that will be regenerated by the system again.',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'warning',
                        'fieldCheckboxChecked'           : false,
                        'fieldCheckboxLabel'             : 'VAR DIRECTORY',
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'external_vendor_dir',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup external (third party) vendor directory? Note: External code can be restored using composer.',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'warning',
                        'fieldCheckboxLabel'             : 'BACKUP EXTERNAL VENDOR DIRECTORY',
                        'fieldCheckboxChecked'           : false,
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'old_backups',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Old backup files? This will increase the total size of the backup depending on how many backups you have taken before.',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'danger',
                        'fieldCheckboxChecked'           : false,
                        'fieldCheckboxLabel'             : 'OLD BACKUP FILES',
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'database',
                        'fieldLabel'                     : false,
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Backup database?',
                        'fieldRequired'                  : false,
                        'fieldType'                      : 'checkbox',
                        'fieldCheckboxType'              : 'success',
                        'fieldCheckboxChecked'           : true,
                        'fieldCheckboxLabel'             : 'DATABASE',
                        'fieldBazJstreeSearch'           : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldBazScan'                   : true
                    ]
                )}}
            </div>
        </div>
        <hr class="mt-0">
        <div class="backup-progress mb-3" hidden>
            <div class="progress active progress-xs">
                <div class="progress-bar progress-xs bg-info progress-bar-animated progress-bar-striped backup-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" style="width: 0%"></div>
            </div>
            <div class="row text-center text-sm text-primary m-1">
                <div class="col">
                    <span class="sr-only progress-span"></span>
                    <span class="progress-span"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col text-center">
                {{adminltetags.useTag('buttons',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'buttonType'                     : 'button',
                        'buttons'                        :
                            [
                                'backup'    : [
                                    'title'                   : 'Generate Backup',
                                    'size'                    : 'xs',
                                    'type'                    : 'primary',
                                    'icon'                    : 'cog fa-spin',
                                    'iconHidden'              : true
                                ]
                            ]
                    ]
                )}}
            </div>
        </div>
    </div>
    <div class="col">
        <legend>RESTORE</legend>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                     : component,
                        'componentName'                 : componentName,
                        'componentId'                   : componentId,
                        'sectionId'                     : sectionId,
                        'fieldId'                       : 'upload_restore',
                        'fieldType'                     : 'files/dropzone',
                        'fieldLabel'                    : false,
                        'fieldDropzoneLabel'            : 'Upload Backup',
                        'fieldRequired'                 : false,
                        'fieldHelp'                     : true,
                        'fieldHelpTooltipContent'       : 'Max: 1. Upload backup file. Acceptable extension .zip. File should be downloaded from this system for restore to work properly and file must include backupInfo.json that was generated at the time of backup.',
                        'fieldAdditionalClass'          : 'mb-1',
                        'fieldBazScan'                  : true,
                        'fieldBazPostOnCreate'          : false,
                        'fieldBazPostOnUpdate'          : false,
                        'attachments'                   : [],
                        'maxAttachments'                : 1,
                        'noPreview'                     : true,
                        'uploadDirectory'               : '.backups',
                        'isBackupFile'                  : true,
                        'storage'                       : storage,
                        'setOrphan'                     : false,
                        'upload'                        : true
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'backups',
                        'fieldLabel'                     : 'Select Backup To Restore',
                        'fieldType'                      : 'select2',
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Select backup that you want to restore. If there is none in the list, you can upload a backup file.',
                        'fieldBazScan'                   : true,
                        'fieldRequired'                  : true,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldDataSelect2Options'        : dbStorageFiles,
                        'fieldDataSelect2OptionsKey'     : 'uuid',
                        'fieldDataSelect2OptionsValue'   : 'org_file_name',
                        'fieldDataSelect2OptionsArray'   : true,
                        'fieldDataSelect2OptionsSelected': ''
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col text-center">
                {{adminltetags.useTag('buttons',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'buttonType'                     : 'button',
                        'buttons'                        :
                            [
                                'remove'    : [
                                    'title'                   : 'remove',
                                    'size'                    : 'xs',
                                    'disabled'                : true,
                                    'type'                    : 'danger',
                                    'icon'                    : 'times'
                                ],
                                'download'    : [
                                    'title'                   : 'download',
                                    'size'                    : 'xs',
                                    'disabled'                : true,
                                    'icon'                    : 'download',
                                    'url'                     : '#'
                                ],
                                'restore'    : [
                                    'title'                   : 'restore',
                                    'size'                    : 'xs',
                                    'disabled'                : true,
                                    'icon'                    : 'rotate-left'
                                ]
                            ]
                    ]
                )}}
            </div>
        </div>
        <div id="restore-fields" hidden>
            <hr>
            <div class="row">
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'restore_db_name',
                            'fieldLabel'                     : 'Database Name',
                            'fieldType'                      : 'input',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Name of the database to use at the time of restore.',
                            'fieldRequired'                  : true,
                            'fieldBazScan'                   : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldDataInputMinLength'        : 1,
                            'fieldDataInputMaxLength'        : 50,
                            'fieldValue'                     : ''
                        ]
                    )}}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'restore_charset',
                            'fieldLabel'                     : 'Database Charset',
                            'fieldType'                      : 'input',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Charset of database',
                            'fieldRequired'                  : true,
                            'fieldBazScan'                   : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldDataInputMinLength'        : 1,
                            'fieldDataInputMaxLength'        : 50,
                            'fieldValue'                     : ''
                        ]
                    )}}
                </div>
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'restore_collation',
                            'fieldLabel'                     : 'Database Collation',
                            'fieldType'                      : 'input',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Collation of database',
                            'fieldRequired'                  : true,
                            'fieldBazScan'                   : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldDataInputMinLength'        : 1,
                            'fieldDataInputMaxLength'        : 50,
                            'fieldValue'                     : ''
                        ]
                    )}}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'restore_db_username',
                            'fieldLabel'                     : 'Database Username',
                            'fieldType'                      : 'input',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Username of the database',
                            'fieldRequired'                  : true,
                            'fieldBazScan'                   : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldDataInputMinLength'        : 1,
                            'fieldDataInputMaxLength'        : 50,
                            'fieldValue'                     : ''
                        ]
                    )}}
                </div>
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'restore_db_password',
                            'fieldLabel'                     : 'Database User Password',
                            'fieldType'                      : 'input',
                            'fieldInputType'                 : 'password',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Password of database.',
                            'fieldRequired'                  : true,
                            'fieldBazScan'                   : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldDataInputMinLength'        : 1,
                            'fieldDataInputMaxLength'        : 50,
                            'fieldGroupPostAddonButtons'     :
                                {
                                    'restore_db_password_generate'   : {
                                        'title'                         : false,
                                        'icon'                          : 'wand-magic-sparkles',
                                        'noMargin'                      : true,
                                        'buttonAdditionalClass'         : 'rounded-0'
                                    }
                                },
                            'fieldAdditionalClass'           : 'mb-0',
                            'fieldValue'                     : ''
                        ]
                    )}}
                    {{adminltetags.useTag('fields',
                        [
                            'component'                             : component,
                            'componentName'                         : componentName,
                            'componentId'                           : componentId,
                            'sectionId'                             : sectionId,
                            'fieldId'                               : 'restore_db_password_strength_meter',
                            'fieldLabel'                            : false,
                            'fieldHidden'                           : false,
                            'fieldType'                             : 'html',
                            'fieldRequired'                         : false,
                            'fieldBazScan'                          : true,
                            'fieldBazPostOnCreate'                  : false,
                            'fieldBazPostOnUpdate'                  : false
                        ]
                    )}}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'db_drop',
                            'fieldLabel'                     : 'Drop if exists?',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Drop database/tables if already exists in the system?',
                            'fieldRequired'                  : false,
                            'fieldType'                      : 'checkbox',
                            'fieldCheckboxType'              : 'info',
                            'fieldCheckboxChecked'           : false,
                            'fieldBazJstreeSearch'           : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldBazScan'                   : true
                        ]
                    )}}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'restore_root_username',
                            'fieldLabel'                     : 'Root Username',
                            'fieldType'                      : 'input',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Username with database create permission.',
                            'fieldRequired'                  : true,
                            'fieldBazScan'                   : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldDataInputMinLength'        : 1,
                            'fieldDataInputMaxLength'        : 50,
                            'fieldValue'                     : ''
                        ]
                    )}}
                </div>
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'restore_root_password',
                            'fieldLabel'                     : 'Root Password',
                            'fieldType'                      : 'input',
                            'fieldInputType'                 : 'password',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Password with database create permission.',
                            'fieldRequired'                  : true,
                            'fieldBazScan'                   : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false,
                            'fieldDataInputMinLength'        : 1,
                            'fieldDataInputMaxLength'        : 50,
                            'fieldValue'                     : ''
                        ]
                    )}}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    {{adminltetags.useTag('buttons',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'buttonType'                     : 'button',
                            'buttons'                        :
                                [
                                    'start-restore'    : [
                                        'title'                   : 'start',
                                        'size'                    : 'xs',
                                        'additionalClass'         : 'mt-1',
                                        'position'                : 'right',
                                        'icon'                    : 'cog fa-spin',
                                        'iconHidden'              : true
                                    ],
                                    'cancel-restore'    : [
                                        'title'                   : 'Cancel',
                                        'size'                    : 'xs',
                                        'type'                    : 'secondary',
                                        'additionalClass'         : 'mt-1',
                                        'position'                : 'right'
                                    ]
                                ]
                        ]
                    )}}
                </div>
            </div>
        </div>
    </div>
</div>
<script>
/* globals PNotify Swal */
var dataCollectionComponent, dataCollectionSection, dataCollectionSectionForm;

if (!window['dataCollection']['{{componentId}}']) {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'] = { };
} else {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'];
}
if (!dataCollectionComponent['{{componentId}}-{{sectionId}}']) {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'] = { };
} else {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'];
}
if (!dataCollectionSection['{{componentId}}-{{sectionId}}-form']) {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'] = { };
} else {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'];
}

dataCollectionSectionForm['vars'] = { };
dataCollectionSectionForm['funcs'] = { };

dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-apps_dir'                                : { },
        '{{componentId}}-{{sectionId}}-systems_dir'                             : { },
        '{{componentId}}-{{sectionId}}-public_dir'                              : { },
        '{{componentId}}-{{sectionId}}-private_dir'                             : { },
        '{{componentId}}-{{sectionId}}-external_dir'                            : { },
        '{{componentId}}-{{sectionId}}-html_compiled'                           : { },
        '{{componentId}}-{{sectionId}}-var_dir'                                 : { },
        '{{componentId}}-{{sectionId}}-external_vendor_dir'                     : {
            afterInit : function() {
                $('#{{componentId}}-{{sectionId}}-external_vendor_dir').click(function() {
                    if ($(this)[0].checked === true) {
                        $('#{{componentId}}-{{sectionId}}-external_dir')[0].checked = true;
                        $('#{{componentId}}-{{sectionId}}-external_dir').attr('disabled', true);
                    } else {
                        $('#{{componentId}}-{{sectionId}}-external_dir').attr('disabled', false);
                    }
                });
            }
        },
        '{{componentId}}-{{sectionId}}-old_backups'                             : { },
        '{{componentId}}-{{sectionId}}-database'                                : { },
        '{{componentId}}-{{sectionId}}-db_drop'                                 : { },
        '{{componentId}}-{{sectionId}}-restore_root_username'                   : { },
        '{{componentId}}-{{sectionId}}-restore_root_password'                   : { },
        '{{componentId}}-{{sectionId}}-restore_db_name'                         : { },
        '{{componentId}}-{{sectionId}}-restore_charset'                         : { },
        '{{componentId}}-{{sectionId}}-restore_collation'                       : { },
        '{{componentId}}-{{sectionId}}-restore_db_username'                     : { },
        '{{componentId}}-{{sectionId}}-restore_db_password'                     : {
            afterInit : function() {
                $('#{{componentId}}-{{sectionId}}-restore_db_password_generate').click(function(e) {
                    e.preventDefault();

                    var postData = { };
                    postData[$('#security-token').attr('name')] = $('#security-token').val();

                    $.post('{{links.url("system/tools/backuprestore/generatePw")}}', postData, function(response) {
                        if (response.responseCode == 0) {
                            if (response.responseData.password) {
                                $('#{{componentId}}-{{sectionId}}-restore_db_password').val(response.responseData.password).trigger('change');
                                $('#{{componentId}}-{{sectionId}}-restore_db_password').attr('type', 'text');
                            }
                        } else {
                            PNotify.error(response.responseMessage);
                        }
                        if (response.tokenKey && response.token) {
                            $("#security-token").attr("name", response.tokenKey);
                            $("#security-token").val(response.token);
                        }
                        $('#{{componentId}}-{{sectionId}}-restore_db_password').keyup(function() {
                            if ($(this).val() === '') {
                                $(this).attr('type', 'password');
                            }
                        });
                    }, 'json');
                });
            }
        },
        '{{componentId}}-{{sectionId}}-restore_db_password_strength_meter'      : {
            afterInit : function() {
                $('#{{componentId}}-{{sectionId}}-restore_db_password_strength_meter').strengthMeter({
                    "url"       : '{{links.url("system/core/checkPwStrength")}}',
                    "postData"  : {
                        "session"           : $('#session-token').val()
                    }
                });
            }
        },
        '{{componentId}}-{{sectionId}}-backups'                                 : {
            placeholder : "SELECT DATABASE TO RESTORE",
            allowClear  : true,
            afterInit   : function() {
                $('#{{componentId}}-{{sectionId}}-backups').on('select2:select', function(e) {
                    dataCollectionSectionForm['funcs']['addedNewBackupOption'](e.params.data.id, e.params.data.text);
                });

                $('#{{componentId}}-{{sectionId}}-backups').on('select2:clear', function(e) {
                    dataCollectionSectionForm['funcs']['clearFields']('remove');
                });

                function generateBackup() {
                    // $('#{{componentId}}-{{sectionId}}-backup').attr('disabled', true);
                    // $('#{{componentId}}-{{sectionId}}-backup').children('i').attr('hidden', false);

                    var postData = { };
                    postData[$('#security-token').attr('name')] = $('#security-token').val();
                    postData['apps_dir'] = $('#{{componentId}}-{{sectionId}}-apps_dir')[0].checked;
                    postData['systems_dir'] = $('#{{componentId}}-{{sectionId}}-systems_dir')[0].checked;
                    postData['public_dir'] = $('#{{componentId}}-{{sectionId}}-public_dir')[0].checked;
                    postData['private_dir'] = $('#{{componentId}}-{{sectionId}}-private_dir')[0].checked;
                    postData['html_compiled'] = $('#{{componentId}}-{{sectionId}}-html_compiled')[0].checked;
                    postData['var_dir'] = $('#{{componentId}}-{{sectionId}}-var_dir')[0].checked;
                    postData['external_dir'] = $('#{{componentId}}-{{sectionId}}-external_dir')[0].checked;
                    postData['external_vendor_dir'] = $('#{{componentId}}-{{sectionId}}-external_vendor_dir')[0].checked;
                    postData['old_backups'] = $('#{{componentId}}-{{sectionId}}-old_backups')[0].checked;
                    postData['database'] = $('#{{componentId}}-{{sectionId}}-database')[0].checked;

                    $.post('{{links.url("system/tools/backuprestore/backup")}}', postData, function(response) {
                        if (response.tokenKey && response.token) {
                            $('#security-token').attr('name', response.tokenKey);
                            $('#security-token').val(response.token);
                        }

                        if (response.responseCode == 0) {
                            PNotify.success({text : response.responseMessage});

                            var data = {
                                id: response.responseData['uuid'],
                                text: response.responseData['filename']
                            };

                            var newOption = new Option(data.text, data.id, false, false);
                            $('#{{componentId}}-{{sectionId}}-backups').append(newOption).val(data.id).trigger('change');
                            dataCollectionSectionForm['funcs']['addedNewBackupOption'](data.id, data.text);

                            $('#{{componentId}}-{{sectionId}}-backup').attr('disabled', false);
                            $('#{{componentId}}-{{sectionId}}-backup').children('i').attr('hidden', true);
                        } else {
                            PNotify.error({text : response.responseMessage});
                        }
                    }, 'json');
                }

                $('#{{componentId}}-{{sectionId}}-backup').click(function(e) {
                    e.preventDefault();

                    generateBackup();
                });
            }
        },
        '{{componentId}}-{{sectionId}}-form'                                    : $.extend(dataCollectionSectionForm, {
            rules: {
            },
            messages: {
            },
            onSubmit : function() {
                return true;
            }
        })
    });

var swalSound = window['dataCollection'].env.sounds.swalSound;

dataCollectionSectionForm['funcs']['clearFields'] = function(fields = 'restore', clear = true) {
    $('#restore-fields').attr('hidden', true);
    $('#{{componentId}}-{{sectionId}}-restore_db_username, ' +
      '#{{componentId}}-{{sectionId}}-restore_db_password, ' +
      '#{{componentId}}-{{sectionId}}-restore_root_username, ' +
      '#{{componentId}}-{{sectionId}}-restore_root_password').val('');
    $('#{{componentId}}-{{sectionId}}-db_drop')[0].checked = false;

    if (clear) {
        $('#{{componentId}}-{{sectionId}}-restore, #{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
        $('#{{componentId}}-{{sectionId}}-download').addClass('disabled');
        $('#{{componentId}}-{{sectionId}}-download').attr('href', '#');
        $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
    }
}

dataCollectionSectionForm['funcs']['addedNewBackupOption'] = function(id, text) {
    dataCollectionSectionForm['funcs']['clearFields']('restore', false);
    $('#{{componentId}}-{{sectionId}}-restore').attr('disabled', false);
    $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', false);
    $('#{{componentId}}-{{sectionId}}-restore, #{{componentId}}-{{sectionId}}-remove').attr('disabled', false);
    $('#{{componentId}}-{{sectionId}}-download').removeClass('disabled');
    $('#{{componentId}}-{{sectionId}}-download').attr('href', '{{links.url("system/storages/q/uuid/' + id + '")}}');

    $('#{{componentId}}-{{sectionId}}-remove').off();
    $('#{{componentId}}-{{sectionId}}-remove').click(function(e) {
        e.preventDefault();

        Swal.fire({
            title                       : '<span class="text-danger"> Remove restore file from system?</span>',
            icon                        : 'question',
            background                  : 'rgba(0,0,0,.8)',
            backdrop                    : 'rgba(0,0,0,.6)',
            buttonsStyling              : false,
            confirmButtonText           : 'Remove',
            customClass                 : {
                'confirmButton'             : 'btn btn-danger text-uppercase',
                'cancelButton'              : 'ml-2 btn btn-secondary text-uppercase',
            },
            showCancelButton            : true,
            keydownListenerCapture      : true,
            allowOutsideClick           : true,
            allowEscapeKey              : true,
            didOpen                     : function() {
                swalSound.play();
            }
        }).then((result) => {
            if (result.value) {
                var postData = { };
                postData['uuid'] = id;
                postData[$('#security-token').attr('name')] = $('#security-token').val();

                $.post('{{links.url("system/storages/remove")}}', postData, function(response) {
                    if (response.tokenKey && response.token) {
                        $('#security-token').attr('name', response.tokenKey);
                        $('#security-token').val(response.token);
                    }

                    if (response.responseCode == 0) {
                        PNotify.success({text : response.responseMessage});

                        $('#{{componentId}}-{{sectionId}}-backups option[value="' + id + '"]').remove();
                        $('#{{componentId}}-{{sectionId}}-restore, #{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
                        $('#{{componentId}}-{{sectionId}}-download').addClass('disabled');
                        $('#{{componentId}}-{{sectionId}}-download').attr('href', '#');
                    }
                }, 'json');
            }
        });
    });

    $('#{{componentId}}-{{sectionId}}-restore').off();
    $('#{{componentId}}-{{sectionId}}-restore').click(function(e) {
        e.preventDefault();

        $(this).attr('disabled', true);
        $('#restore-fields').attr('hidden', false);
        $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
        var dbname = $('#{{componentId}}-{{sectionId}}-backups').find(':selected').text().trim().slice(0, -4);
        var dbUsername = dbname + 'User';
        $('#{{componentId}}-{{sectionId}}-restore_db_name').val(dbname);
        $('#{{componentId}}-{{sectionId}}-restore_charset').val('utf8mb4');
        $('#{{componentId}}-{{sectionId}}-restore_collation').val('utf8mb4_general_ci');
        $('#{{componentId}}-{{sectionId}}-restore_db_username').val(dbUsername);
    });

    $('#{{componentId}}-{{sectionId}}-cancel-restore').off();
    $('#{{componentId}}-{{sectionId}}-cancel-restore').click(function(e) {
        e.preventDefault();

        dataCollectionSectionForm['funcs']['clearFields']('restore', false);
    });
    $('#{{componentId}}-{{sectionId}}-start-restore').off();
    $('#{{componentId}}-{{sectionId}}-start-restore').click(function(e) {
        e.preventDefault();

        if ($('#{{componentId}}-{{sectionId}}-restore_db_name').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_db_name').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_db_name').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_charset').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_charset').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_charset').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_collation').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_collation').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_collation').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_db_username').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_db_username').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_db_username').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_db_password').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_db_password').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_db_password').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_root_username').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_root_username').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_root_username').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else if ($('#{{componentId}}-{{sectionId}}-restore_root_password').val() === '') {
            $('#{{componentId}}-{{sectionId}}-restore_root_password').addClass('is-invalid');
            $('#{{componentId}}-{{sectionId}}-restore_root_password').focus(function() {
                $(this).removeClass('is-invalid');
            });
        } else {
            $(this).attr('disabled', true);
            $(this).children('i').attr('hidden', false);

            var postData = { };
            postData['filename'] = text;
            postData['dbname'] = $('#{{componentId}}-{{sectionId}}-restore_db_name').val();
            postData['charset'] = $('#{{componentId}}-{{sectionId}}-restore_charset').val();
            postData['collation'] = $('#{{componentId}}-{{sectionId}}-restore_collation').val();
            postData['username'] = $('#{{componentId}}-{{sectionId}}-restore_db_username').val();
            postData['password'] = $('#{{componentId}}-{{sectionId}}-restore_db_password').val();
            postData['root_username'] = $('#{{componentId}}-{{sectionId}}-restore_root_username').val();
            postData['root_password'] = $('#{{componentId}}-{{sectionId}}-restore_root_password').val();
            postData['drop'] = $('#{{componentId}}-{{sectionId}}_drop')[0].checked;
            postData[$('#security-token').attr('name')] = $('#security-token').val();

            $.post('{{links.url("system/tools/backuprestore/restore")}}', postData, function(response) {
                if (response.tokenKey && response.token) {
                    $('#security-token').attr('name', response.tokenKey);
                    $('#security-token').val(response.token);
                }

                if (response.responseCode == 0) {
                    PNotify.success({text : response.responseMessage});

                    dataCollectionSectionForm['vars']['dbs'][response.responseData.newDb.dbname] = response.responseData.newDb;

                    var newOption = new Option(response.responseData.newDb.dbname, response.responseData.newDb.dbname, false, false);
                    $('#{{componentId}}-{{sectionId}}-alldbs').append(newOption).val(response.responseData.newDb.dbname).trigger('change');
                    dataCollectionSectionForm['funcs']['clearFields']('restore');
                    $('#{{componentId}}-{{sectionId}}-backups').val(null).trigger('change');
                    $('#{{componentId}}-{{sectionId}}-is_active')[0].checked = false;
                    $('#{{componentId}}-{{sectionId}}-is_active').attr('disabled', false);
                    $('.generate-backup-span').html('<i class="fas fa-fw fa-cog fa-spin" hidden=""></i> Backup ' + response.responseData.newDb.dbname + ' db');
                    $('.update-span').html('<i class="fas fa-fw fa-cog fa-spin" hidden=""></i> Update ' + response.responseData.newDb.dbname + ' db');
                    $('.delete-span').html('<i class="fas fa-fw fa-cog fa-spin" hidden=""></i> Remove ' + response.responseData.newDb.dbname + ' db');
                    $('#{{componentId}}-{{sectionId}}-remove').attr('disabled', true);
                    $('#{{componentId}}-{{sectionId}}-download').attr('disabled', true);
                    $('#{{componentId}}-{{sectionId}}-restore').attr('disabled', true);
                    $('#{{componentId}}-{{sectionId}}-backup').attr('disabled', false);
                    $('#{{componentId}}-{{sectionId}}-update').attr('disabled', false);
                    $('#{{componentId}}-{{sectionId}}-delete').attr('disabled', false);
                    $('#{{componentId}}-{{sectionId}}_host').val(response.responseData.newDb.host);
                    $('#{{componentId}}-{{sectionId}}_port').val(response.responseData.newDb.port);
                    $('#{{componentId}}-{{sectionId}}_name').val(response.responseData.newDb.dbname);
                    $('#{{componentId}}-{{sectionId}}_charset').val(response.responseData.newDb.charset);
                    $('#{{componentId}}-{{sectionId}}_collation').val(response.responseData.newDb.collation);
                    $('#{{componentId}}-{{sectionId}}_username').val(response.responseData.newDb.username);
                    $('#{{componentId}}-{{sectionId}}_password').val('');
                } else {
                    PNotify.error({text : response.responseMessage});
                }
                $('#{{componentId}}-{{sectionId}}-start-restore').attr('disabled', false);
                $('#{{componentId}}-{{sectionId}}-start-restore').children('i').attr('hidden', true);
            }, 'json');
        }
    });
}

$('#body').on('dropzoneInitDone', function() {
    dataCollectionSection['admin-backuprestore-main-upload_restore']['onSuccess'] = function(file, response) {
        if (response.responseData && response.responseData.name && response.responseData.uuid) {
            var newOption = new Option(response.responseData.name, response.responseData.uuid, false, false);
            $('#{{componentId}}-{{sectionId}}-backups').append(newOption).val(response.responseData.uuid).trigger('change');
            dataCollectionSectionForm['funcs']['addedNewBackupOption'](response.responseData.uuid, response.responseData.name);
            PNotify.success({text: 'File ' + response.responseData.name + ' uploaded and ready to be restored.'});
            dataCollectionSection['admin-backuprestore-main-upload_restore']['reset']();
        }
    };
});
</script>