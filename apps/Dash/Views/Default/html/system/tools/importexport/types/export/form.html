{% if importexport['id'] is defined %}
    {% set fieldHidden = false %}
    {% set fieldDisabled = false %}
    {% set importexportId = importexport['id'] %}
    {% set importexportType = '<span class="badge badge-primary text-uppercase">' ~ importexport['type'] ~ '</span>' %}
    {% if importexport['status'] == '0' %}
        {% set status = '<span class="badge badge-secondary text-uppercase">Scheduled</span>' %}
    {% elseif importexport['status'] == '1' %}
        {% set status = '<span class="badge badge-info text-uppercase">Running</span>' %}
    {% elseif importexport['status'] == '2' %}
        {% set status = '<span class="badge badge-success text-uppercase">Complete</span>' %}
    {% elseif importexport['status'] == '3' %}
        {% set status = '<span class="badge badge-danger text-uppercase">Error</span>' %}
    {% endif %}
    {% set importexportStatus = status %}
    {% if importexport['file'] is not defined or importexport['file'] === '' %}
        {% set importexportFile = '-' %}
    {% else %}
        {% set importexportFile = '<a href="' ~ importexport['file'] ~ '" type="button" class="text-white btn btn-primary btn-xs "><i class="fas fa-fw fa-xs fa-download"></i></a>' %}
    {% endif %}
    {% set importexportComponentId = importexport['component_id'] %}
    {% set importexportFilterId = importexport['filter_id'] %}
    {% set importexportFields = importexport['fields'] %}
    {% set importexportEmailTo = importexport['email_to'] %}
{% else %}
    {% set fieldHidden = true %}
    {% set fieldDisabled = true %}
    {% set importexportId = '' %}
    {% set importexportType = importexport['type'] %}
    {% set importexportStatus = '' %}
    {% set importexportFile = '-' %}
    {% set importexportComponentId = '' %}
    {% set importexportFilterId = '' %}
    {% set importexportFields = '' %}
    {% set importexportEmailTo = '' %}
{% endif %}
<form data-validateon="section" id="{{componentId}}-{{sectionId}}-form">
    <fieldset id="{{componentId}}-{{sectionId}}-fieldset">
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'id',
                        'fieldLabel'                     : 'Import/Export ID',
                        'fieldType'                      : 'input',
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Import/Export ID',
                        'fieldRequired'                  : true,
                        'fieldBazScan'                   : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : true,
                        'fieldHidden'                    : true,
                        'fieldDisabled'                  : true,
                        'fieldValue'                     : importexportId
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'type',
                        'fieldLabel'                     : 'Type',
                        'fieldType'                      : 'html',
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Type',
                        'fieldRequired'                  : false,
                        'fieldHidden'                    : fieldHidden,
                        'fieldBazScan'                   : true,
                        'fieldBazPostOnCreate'           : true,
                        'fieldBazPostOnUpdate'           : true,
                        'fieldHtmlContent'               : importexportType
                    ]
                )}}
            </div>
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'status',
                        'fieldLabel'                     : 'Status',
                        'fieldType'                      : 'html',
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'Status',
                        'fieldRequired'                  : false,
                        'fieldHidden'                    : fieldHidden,
                        'fieldBazScan'                   : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldHtmlContent'               : importexportStatus
                    ]
                )}}
            </div>
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                      : component,
                        'componentName'                  : componentName,
                        'componentId'                    : componentId,
                        'sectionId'                      : sectionId,
                        'fieldId'                        : 'file',
                        'fieldLabel'                     : 'File',
                        'fieldType'                      : 'html',
                        'fieldHelp'                      : true,
                        'fieldHelpTooltipContent'        : 'File to download',
                        'fieldRequired'                  : false,
                        'fieldHidden'                    : fieldHidden,
                        'fieldBazScan'                   : true,
                        'fieldBazPostOnCreate'           : false,
                        'fieldBazPostOnUpdate'           : false,
                        'fieldHtmlContent'               : importexportFile
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                            : component,
                        'componentName'                        : componentName,
                        'componentId'                          : componentId,
                        'sectionId'                            : sectionId,
                        'fieldId'                              : 'component_id',
                        'fieldLabel'                           : 'Component',
                        'fieldType'                            : 'select2',
                        'fieldHelp'                            : true,
                        'fieldHelpTooltipContent'              : "Select component",
                        'fieldRequired'                        : true,
                        'fieldBazScan'                         : true,
                        'fieldBazJstreeSearch'                 : true,
                        'fieldBazPostOnCreate'                 : true,
                        'fieldBazPostOnUpdate'                 : true,
                        'fieldDataSelect2Options'              : components,
                        'fieldDataSelect2OptionsKey'           : 'id',
                        'fieldDataSelect2OptionsValue'         : 'name',
                        'fieldDataSelect2OptionsArray'         : true,
                        'fieldDataSelect2OptionsSelected'      : importexportComponentId
                    ]
                )}}
            </div>
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                            : component,
                        'componentName'                        : componentName,
                        'componentId'                          : componentId,
                        'sectionId'                            : sectionId,
                        'fieldId'                              : 'filter_id',
                        'fieldLabel'                           : 'Filter',
                        'fieldType'                            : 'select2',
                        'fieldHelp'                            : true,
                        'fieldHelpTooltipContent'              : "Select Filter",
                        'fieldRequired'                        : false,
                        'fieldDisabled'                        : fieldDisabled,
                        'fieldBazScan'                         : true,
                        'fieldBazJstreeSearch'                 : true,
                        'fieldBazPostOnCreate'                 : true,
                        'fieldBazPostOnUpdate'                 : true,
                        'fieldDataSelect2Options'              : filters,
                        'fieldDataSelect2OptionsKey'           : 'id',
                        'fieldDataSelect2OptionsValue'         : 'name',
                        'fieldDataSelect2OptionsArray'         : true,
                        'fieldDataSelect2OptionsSelected'      : importexportFilterId
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                            : component,
                        'componentName'                        : componentName,
                        'componentId'                          : componentId,
                        'sectionId'                            : sectionId,
                        'fieldId'                              : 'fields',
                        'fieldLabel'                           : 'Fields',
                        'fieldType'                            : 'select2',
                        'fieldHelp'                            : true,
                        'fieldHelpTooltipContent'              : "Select fields to export",
                        'fieldRequired'                        : true,
                        'fieldDisabled'                        : fieldDisabled,
                        'fieldBazScan'                         : true,
                        'fieldBazJstreeSearch'                 : true,
                        'fieldBazPostOnCreate'                 : true,
                        'fieldBazPostOnUpdate'                 : true,
                        'fieldDataSelect2Multiple'             : true,
                        'fieldDataSelect2Options'              : fields,
                        'fieldDataSelect2OptionsKey'           : 'id',
                        'fieldDataSelect2OptionsValue'         : 'name',
                        'fieldDataSelect2OptionsArray'         : true,
                        'fieldDataSelect2OptionsSelected'      : importexportFields
                    ]
                )}}
            </div>
        </div>
        <div class="row">
            <div class="col">
                {{adminltetags.useTag('fields',
                    [
                        'component'                             : component,
                        'componentName'                         : componentName,
                        'componentId'                           : componentId,
                        'sectionId'                             : sectionId,
                        'fieldId'                               : 'email_to',
                        'fieldLabel'                            : 'CC Notification Email To',
                        'fieldType'                             : 'input',
                        'fieldHelp'                             : true,
                        'fieldHelpTooltipContent'               : 'CC request ready notification emails to. Email addresses separated by comma.',
                        'fieldRequired'                         : false,
                        'fieldBazJstreeSearch'                  : true,
                        'fieldBazScan'                          : true,
                        'fieldBazPostOnCreate'                  : true,
                        'fieldBazPostOnUpdate'                  : true,
                        'fieldDataInputMinLength'               : 1,
                        'fieldDataInputMaxLength'               : 2048,
                        'fieldValue'                            : importexportEmailTo
                    ]
                )}}
            </div>
        </div>
    </fieldset>
</form>
<script>
/* globals PNotify */
var dataCollectionComponent, dataCollectionSection, dataCollectionSectionForm;

if (!window['dataCollection']['{{componentId}}']) {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'] = { };
} else {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'];
}
if (!dataCollectionComponent['{{componentId}}-{{sectionId}}']) {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'] = { };
} else {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'];
}
if (!dataCollectionSection['{{componentId}}-{{sectionId}}-form']) {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'] = { };
} else {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'];
}

dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-id'                      : { },
        '{{componentId}}-{{sectionId}}-type'                    : {
            afterInit: function() {
                window['dataCollection']['{{componentId}}']['{{componentId}}-{{sectionId}}']['data']['type'] = "{{importexport['type']}}";
            }
        },
        '{{componentId}}-{{sectionId}}-status'                  : { },
        '{{componentId}}-{{sectionId}}-file'                    : { },
        '{{componentId}}-{{sectionId}}-component_id'            : {
            "placeholder" : "SELECT COMPONENT"
        },
        '{{componentId}}-{{sectionId}}-filter_id'               : {
            "placeholder" : "SELECT FILTER"
        },
        '{{componentId}}-{{sectionId}}-fields'                  : {
            "placeholder"   : "SELECT FIELDS",
            afterInit       : function() {
                $('#{{componentId}}-{{sectionId}}-component_id').on('select2:select', function(e) {
                    $('#{{componentId}}-{{sectionId}}-fields').attr('disabled', true);
                    $('#{{componentId}}-{{sectionId}}-fields').find('option').remove();
                    $('#{{componentId}}-{{sectionId}}-fields').val(null).trigger('change');
                    var postData = { };
                    postData['id'] = e.params.data.id;
                    postData[$('#security-token').attr('name')] = $('#security-token').val();

                    $.post('{{links.url("system/tools/importexport/getPackageFields")}}', postData, function(response) {
                        if (response.tokenKey && response.token) {
                            $('#security-token').attr('name', response.tokenKey);
                            $('#security-token').val(response.token);
                        }

                        var newOption, selected;

                        if (response && response.responseData && response.responseData.fields) {
                            for (var field in response.responseData.fields) {
                                newOption = new Option(response.responseData.fields[field], field, false, true);
                                $('#{{componentId}}-{{sectionId}}-fields').append(newOption).trigger('change');
                            }

                            $('#{{componentId}}-{{sectionId}}-fields').attr('disabled', false);
                        }

                        if (response && response.responseData && response.responseData.filters) {
                            for (var filter in response.responseData.filters) {
                                selected = false;

                                if (response.responseData.filters[filter]['name'].includes("Show All")) {
                                    selected = true;
                                }

                                newOption = new Option(response.responseData.filters[filter]['name'], response.responseData.filters[filter]['id'], false, selected);
                                $('#{{componentId}}-{{sectionId}}-filter_id').append(newOption).trigger('change');
                            }

                            $('#{{componentId}}-{{sectionId}}-filter_id').attr('disabled', false);
                        }
                    }, 'json');
                });
            }
        },
        '{{componentId}}-{{sectionId}}-email_to'                : { },
        '{{componentId}}-{{sectionId}}-form'                    : {
            ignore      : ':submit, :reset, :image, :disabled, .ignore, .cr-slider',
            rules: {
                '{{componentId}}-{{sectionId}}-component_id'    : 'required',
                '{{componentId}}-{{sectionId}}-fields'          : 'required',
            },
            messages: {
                '{{componentId}}-{{sectionId}}-component_id'    : 'Please select component',
                '{{componentId}}-{{sectionId}}-fields'          : 'Please select fields to export',
            }
        }
    });
</script>