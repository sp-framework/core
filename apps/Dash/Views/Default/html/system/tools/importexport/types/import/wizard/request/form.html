<form data-validateon="section" id="{{componentId}}-{{sectionId}}-form">
    <fieldset id="{{componentId}}-{{sectionId}}-fieldset">
        {% if step is defined and step === 'upload' %}
            <div class="row">
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                            : component,
                            'componentName'                        : componentName,
                            'componentId'                          : componentId,
                            'sectionId'                            : sectionId,
                            'fieldId'                              : 'component_id',
                            'fieldLabel'                           : 'Component',
                            'fieldType'                            : 'select2',
                            'fieldHelp'                            : true,
                            'fieldHelpTooltipContent'              : "Select component",
                            'fieldRequired'                        : true,
                            'fieldBazScan'                         : true,
                            'fieldBazJstreeSearch'                 : true,
                            'fieldBazPostOnCreate'                 : true,
                            'fieldBazPostOnUpdate'                 : true,
                            'fieldDataSelect2Options'              : components,
                            'fieldDataSelect2OptionsKey'           : 'id',
                            'fieldDataSelect2OptionsValue'         : 'name',
                            'fieldDataSelect2OptionsArray'         : true,
                            'fieldDataSelect2OptionsSelected'      : ''
                        ]
                    )}}
                </div>
            </div>
            <div class="row vdivide download-upload" hidden>
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                      : component,
                            'componentName'                  : componentName,
                            'componentId'                    : componentId,
                            'sectionId'                      : sectionId,
                            'fieldId'                        : 'download-link',
                            'fieldLabel'                     : 'Download Structure File',
                            'fieldType'                      : 'html',
                            'fieldHelp'                      : true,
                            'fieldHelpTooltipContent'        : 'Download structure file for selected component.',
                            'fieldAdditionalClass'           : 'mb-0',
                            'fieldHtmlContent'               : '<div class="link text-center text-uppercase"></div>',
                            'fieldBazScan'                   : true,
                            'fieldBazJstreeSearch'           : true,
                            'fieldBazPostOnCreate'           : false,
                            'fieldBazPostOnUpdate'           : false
                        ]
                    )}}
                </div>
                <div class="col">
                    {{adminltetags.useTag('fields',
                        [
                            'component'                     : component,
                            'componentName'                 : componentName,
                            'componentId'                   : componentId,
                            'sectionId'                     : sectionId,
                            'fieldId'                       : 'upload',
                            'fieldType'                     : 'files/dropzone',
                            'fieldLabel'                    : false,
                            'fieldDropzoneLabel'            : 'Upload File (CSV)',
                            'fieldRequired'                 : false,
                            'fieldHelp'                     : true,
                            'fieldHelpTooltipContent'       : 'Max: 1. Upload a CSV file.',
                            'fieldBazScan'                  : true,
                            'fieldBazPostOnCreate'          : true,
                            'fieldBazPostOnUpdate'          : true,
                            'attachments'                   : [],
                            'maxAttachments'                : 1,
                            'storage'                       : storage,
                            'upload'                        : true,
                            'allowedUploads'                : 'files'
                        ]
                    )}}
                </div>
            </div>
        {% endif %}
    </fieldset>
</form>
{% if step is defined and step === 'pair' %}
    <script>
/* globals PNotify */
var dataCollectionComponent, dataCollectionSection, dataCollectionSectionForm;

if (!window['dataCollection']['{{componentId}}']) {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'] = { };
} else {
    dataCollectionComponent =
        window['dataCollection']['{{componentId}}'];
}
if (!dataCollectionComponent['{{componentId}}-{{sectionId}}']) {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'] = { };
} else {
    dataCollectionSection =
        dataCollectionComponent['{{componentId}}-{{sectionId}}'];
}
if (!dataCollectionSection['{{componentId}}-{{sectionId}}-form']) {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'] = { };
} else {
    dataCollectionSectionForm =
        dataCollectionSection['{{componentId}}-{{sectionId}}-form'];
}
dataCollectionSection =
    $.extend(dataCollectionSection, {
        '{{componentId}}-{{sectionId}}-component_id'            : {
            "placeholder" : "SELECT COMPONENT"
        },
        '{{componentId}}-{{sectionId}}-download-link'           : {
            afterInit       : function() {
                if (dataCollectionComponent['{{componentId}}-{{sectionId}}']['initFields'] === true) {
                    return;
                }

                $('#{{componentId}}-{{sectionId}}-component_id').on('select2:select', function(e) {
                    var postData = { };
                    postData['component_id'] = e.params.data.id;
                    postData[$('#security-token').attr('name')] = $('#security-token').val();

                    $.post('{{links.url("system/tools/importexport/getSampleFileLink")}}', postData, function(response) {
                        if (response.tokenKey && response.token) {
                            $('#security-token').attr('name', response.tokenKey);
                            $('#security-token').val(response.token);
                        }

                        if (response.responseData && response.responseData.link) {
                            $('.link').html(
                                '<a href="' + response.responseData.link + '" class="btn btn-app bg-primary p-2"><i class="fas fa-download mb-2"></i> Structures File</a>'
                            );
                        }

                        $('.download-upload').attr('hidden', false);
                    }, 'json');
                });
            }
        },
        '{{componentId}}-{{sectionId}}-form'                    : {
            ignore      : ':submit, :reset, :image, :disabled, .ignore, .cr-slider',
            rules: {
                '{{componentId}}-{{sectionId}}-component_id'    : 'required',
            },
            messages: {
                '{{componentId}}-{{sectionId}}-component_id'    : 'Please select component',
            }
        }
    });
</script>
{% endif %}